(()=>{"use strict";var __webpack_modules__={644:(e,t,n)=>{n.d(t,{u:()=>p,Y:()=>g});var s=n(204);const o={};var a=n(321),i=n(152),r=n(517),l=n(827),d=n(160),_=n(601);const c=(0,a.rj)();function p(e){return new m(e)}function u(e){if(!e)throw new Error("Assertion failed!")}(0,s.o9)("loader.all",{}),(0,s.oE)("MIDT",{});class f{constructor(e){this.internalConfig=Object.freeze(e)}get(e){return r.Z.getConfigVal(this.internalConfig.id,this.internalConfig.stgid,e)}set(e){r.Z.setConfigVal(this.internalConfig.id,this.internalConfig.stgid,e)}}class b{static acquireCommon(){return(0,s.vo)("VERHASH")?new b:null}showOfflineWindow(e,t,n){(0,d.NE)(e,t,n)}loadExtra(e,t){(0,s.vo)("$F")("__onExtraScriptLoaded",[t],e)}}class m{constructor(e){this.local={},this.LoaderEvent=l.a,this.getAPIVersion=g,this.download=c.GM_download,this.export_=e=>{!function(e,t){(0,s.oE)("module-export-"+e,t),function(e){for(var t in(0,s.vo)("MIDT"))if(t==e){(0,s.vo)("MIDT")[t]((0,s.vo)("module-export-"+e));var n=(0,s.vo)("MIDT");delete n[t],(0,s.oE)("MIDT",n)}}(e)}(this.id,e)},this.import_=h,this.GM_download=c.GM_download,this.GM_setValue=this.storeData,this.GM_getValue=this.getData,this.sysNotification=c.GM_notification,this.GIDURL=i.C5,this.id=e;let t=(0,s.o9)("loader.all").gid;this.gid=t?Object.freeze(i.C5.fromString(t)):i.C5.NIL,function(e,t){return!!function(e){if(o[e])return o[e];let t=o[e]={},n=(0,s.o9)("meta-"+e,{});if(n.permissions)for(let e of n.permissions.split(","))t[e.trim()]=!0;return t}(e)[t.trim()]}(e,"loader:core")?(this.eval=i.AS,this.GM=(0,a.rj)()):(this.eval=void 0,this.GM=void 0)}get $(){return(0,s.vo)("jq")}storeData(e,t){var n,o;n=this.id+"-"+e,o=t,(0,s.s4)("data-"+n,o)}createConfig(e,t,n,s,o=(e=>{}),a=""){return u("string"==typeof e),u("string"==typeof t),u("string"==typeof n),u("string"==typeof s),u("function"==typeof o),u("string"==typeof a),new f(r.Z.createConfigItem(this.id,e,t,n,s,o,a))}getConfigVal(e,t){return u("string"==typeof e),r.Z.getConfigVal(this.id,e,t)}setConfigVal(e,t){u("string"==typeof e),r.Z.setConfigVal(this.id,e,t)}getData(e,t){return u("string"==typeof e),n=this.id+"-"+e,o=t,(0,s.o9)("data-"+n,o);var n,o}mountJS(e,t=(()=>{}),n=(e=>{})){u("string"==typeof e||e instanceof i.C5),"string"!=typeof e||/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(e)||(e=i.C5.fromString(e)),e!=i.C5.NIL&&""!=e||n("无效地址"),e instanceof i.C5&&(e=e.asString()),(0,_.e)(e,n,(e=>{let n=document.createElement("script");n.text=e,n.onload=t,document.head.appendChild(n)}),"plain")}mountCSS(e,t=(()=>{}),n=(e=>{})){u("string"==typeof e||e instanceof i.C5),"string"!=typeof e||/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(e)||(e=i.C5.fromString(e)),e!=i.C5.NIL&&""!=e||n("无效地址"),e instanceof i.C5&&(e=e.asString()),(0,_.e)(e,n,(e=>{let n=document.createElement("style");n.innerHTML=e,n.onload=t,document.head.appendChild(n)}),"plain")}popInfo(e){u("string"==typeof e),(0,d.s$)(e)}isModRunning(e){return u("string"==typeof e),(0,s.o9)("loader.sortedModuleList").indexOf(e)>=0}crossOriginRequest(e){return(0,s.h0)(e)}aquireCommon(){return b.acquireCommon()}}function g(){return 2}function h(e,t){if((0,s.vo)("module-export-"+e))t((0,s.vo)("module-export-"+e));else{var n=(0,s.vo)("MIDT")[e];(0,s.vo)("MIDT")[e]=n?e=>{n(e),t(e)}:t}return(0,s.o9)("loader.sortedModuleList").indexOf(e)>=0}},152:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C5:()=>GIDURL,WM:()=>addModule,uk:()=>mountCode,wZ:()=>deleteModule,qA:()=>installFromUrl,jw:()=>parseMeta,eT:()=>isDirty,no:()=>markDirty,AS:()=>coreModEval,t3:()=>resortDependency,BR:()=>getTmpDisabled,ul:()=>getDependencyError,m4:()=>isDependencySolved,GK:()=>installFromGID});var _api_STDAPI__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(644),_encrypt__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(585),_native__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(321),_usfunc__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(204),_manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(313),_static__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(455),_crossorigin__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(601),_craftmcbbs_craft_ui__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(160),_domutils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(23);class GIDURL{constructor(e,t,n,s,o,a=GIDURL.NIL){this.service="~"==e?a.service:e,this.version="~"==t?a.version:t,this.repo="~"==n?a.repo:n,this.file="~"==s?a.file:s,this.provider="~"==o?a.provider:o}static fromString(e,t=GIDURL.NIL){let n=e.split(":");switch(n.length){case 1:return new GIDURL("github","",e,e,"MCBBS-Loader",t);case 2:return new GIDURL("github","",n[1],n[1],n[0],t);case 3:return new GIDURL("github","",n[1],n[2],n[0],t);case 4:return new GIDURL("github",n[3],n[1],n[2],n[0],t);case 5:return new GIDURL(n[0],n[4],n[2],n[3],n[1],t);default:return GIDURL.NIL}}getAsURL(e=".js"){return"github"==this.service?`https://cdn.jsdelivr.net/gh/${this.provider}/${this.repo}${this.version?"@":""}${this.version}/${this.file}${e}`:"gitee"==this.service?`https://gitee.com/${this.provider}/${this.repo}/raw/${this.version}/${this.file}${e}`:""}asString(){return[this.service,this.provider,this.repo,this.file,this.version].join(":")}}GIDURL.NIL=new GIDURL("","","","","",null);const STRING_API_VERSION=String((0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_0__.Y)());let dirty=!1,globalDependencyError=null,globalTmpDisabled=null;function getTmpDisabled(){return null==globalTmpDisabled?globalTmpDisabled=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.tmpDisabled",[]):globalTmpDisabled}function getDependencyError(){return null==globalDependencyError?globalDependencyError=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.dependencyError",""):globalDependencyError}function isDependencySolved(){return!getDependencyError().length}function resortDependency(){return resortDependencyInternal((0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{}),"",[])}function resortDependencyInternal(e,t,n){const s={};let o=(e,t)=>(t.beforeHead=s,t.afterHead=s,t.id=e,t),a=new Map,i=[],r=[],l=new Set;for(let[t,n]of Object.entries(e))n&&a.set(t,o(t,JSON.parse((0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("depend-"+t,"{}")))),((0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("meta-"+t,{}).apiVersion||(0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_0__.Y)())!=(0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_0__.Y)()&&deleteModule(t,(()=>{console.log("[MCBBS Loader] 由于 API 版本不兼容，移除了 ID 为 "+t+" 的脚本。\n如有需要，你可以重新安装。"),(0,_craftmcbbs_craft_ui__WEBPACK_IMPORTED_MODULE_4__.JV)("[MCBBS Loader] 由于 API 版本不兼容，移除了 ID 为 "+t+" 的脚本。\n如有需要，你可以重新安装。")}));let d=(e,t)=>{let n={before:e,after:t,beforeNext:e.beforeHead,afterNext:t.afterHead,beforePrev:s,afterPrev:s};n.beforeNext.beforePrev=n.afterNext.afterPrev=n,t.afterHead=e.beforeHead=n};for(a.forEach(((e,n)=>{let s=e.depend;s instanceof Array&&s.forEach((e=>{a.get(e)||(t+=`${n}依赖${e}，但是后者未安装或未启用。\n`,l.add(n))}));let o=e.before;o instanceof Array&&o.forEach((t=>{let n=a.get(t);n&&d(e,n)}));let i=e.after;i instanceof Array&&i.forEach((t=>{let n=a.get(t);n&&d(n,e)}))})),a.forEach((e=>{e.afterHead===s&&i.push(e)}));i.length;){let e=i.pop();for(r.push(e.id);s!=e.beforeHead;)(_=e.beforeHead).afterNext.afterPrev=_.afterPrev,_.beforeNext.beforePrev=_.beforePrev,_.afterPrev.afterNext=_.afterNext,_.beforePrev.beforeNext=_.beforeNext,_===_.after.afterHead&&(_.after.afterHead=_.afterNext),_===_.before.beforeHead&&(_.before.beforeHead=_.beforeNext),s===_.after.afterHead&&i.push(_.after)}var _;a.forEach((e=>{if(e.beforeHead!=s){l.add(e.id),t+=e.id+"要求在";let n=e.beforeHead;for(;n!=s;)t+=n.after.id+(n.beforeNext===s?"":","),n=n.beforeNext;t+="之前加载，然而此要求无法满足。\n"}}));let c=[];return l.forEach((t=>{c.push(t),delete e[t]})),c.length?(t+="已临时停用"+c.toString()+"\n",resortDependencyInternal(e,t,n.concat(c))):(globalTmpDisabled=n,globalDependencyError=t,(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.sortedModuleList",r),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.dependencyError",t),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.tmpDisabled",n),r)}function verifyId(e){return/^[0-9|a-z|A-Z|\.|_]+$/.test(e)}function addModule(e,t=GIDURL.NIL){let n=e.trim();if(!/\/\*( )*MCBBS[ -]*Module/.test(n))return"这不是一个模块";let s=new Map;parseMeta(n,s);let o,a,i,r=e=>{let t=[];for(let n of e){let e=n.trim();e.length&&t.push(e)}return t},l=s.get("depend")||"",d=s.get("id");if(void 0===d)return"未提供 id 数据值";if(!verifyId(d))return"不合要求的 id";let _=[],c={};for(let e of l.split(",")){let t=e.trim();if(t.length)if(t.includes("->")){let e=/^([0-9|a-z|A-Z|\.|_]+) -> ([0-9|a-z|A-Z|\.|_|:|/|%|@|-]+)$/.exec(t);if(!e||3!=e.length)return"依赖地址编写格式错误";_.push(e[1]),c[e[1]]||(c[e[1]]=[]),c[e[1]].push(e[2])}else _.push(t)}l=_.join(",");let p={id:d,permissions:s.get("permissions")||"",name:_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("name")||s.get("id")),author:_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("author")||"Someone"),icon:s.get("icon")||_static__WEBPACK_IMPORTED_MODULE_7__.QD,depend:l,before:o=s.get("before")||"",after:a=s.get("after")||"",description:_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("description")||"No description provided."),updateURL:s.get("updateURL"),apiVersion:i=s.get("apiVersion"),version:s.get("version")?_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("version")):void 0,gid:t!=GIDURL.NIL?t.asString():s.get("gid")};if((i||STRING_API_VERSION)!=STRING_API_VERSION)return"不支持的 API 版本："+i;if(regMeta(d,p)){(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("code-"+d,n),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("depend-"+d,JSON.stringify({depend:_,before:r(o.split(",")),after:r(a.split(","))})),markDirty();let e=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{});for(let n of _)if(null==e[n]){let e=()=>{if(c[n]&&!c[n].pending&&c[n].length){c[n].pending=!0;let s=c[n].shift();/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(s)?installFromUrl(s,(e=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onInstall(e),c[n].pending=!1}),(t=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onFailure(t),c[n].pending=!1,e()})):installFromGID(GIDURL.fromString(s,t),(e=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onInstall(e),c[n].pending=!1}),(t=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onFailure(t),c[n].pending=!1,e()}))}};e()}return s}return"未知错误"}function parseMeta(e,t){let n=(e.match(/(?<=\/\*( )*MCBBS[ -]*Module)[\s\S]*?(?=\*\/)/)||[])[0]||"";n=n.replace(/\\\n/g,"");let s=n.split("\n"),o=/.+?\=.*/,a=/.+?(?=\=)/,i=/(?<=\=).*/;for(let e of s)if(o.test((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(e))){let n=((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(e).match(a)||[])[0]||"",s=((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(e).match(i)||[])[0]||"";t.set((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(n),(0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(s))}}function regMeta(e,t){(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("meta-"+e,t);let n=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{});try{return(0,_native__WEBPACK_IMPORTED_MODULE_8__.Hn)(n,e,!0),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.all",n),!0}catch(e){return!1}}function mountCode(e,t){_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.load((()=>{let n=document.createElement("script");n.text=`(MCBBS => {${t}})(Object.freeze(window.forkAPI_${(0,_encrypt__WEBPACK_IMPORTED_MODULE_1__.M)()}("${e}")))`,n.id="code-"+e,n.onload=()=>n.remove(),document.body.appendChild(n)}))}function unmountCode(e){_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.load((()=>{(0,_domutils__WEBPACK_IMPORTED_MODULE_5__.Ys)("#code-"+e).remove()}))}function deleteModule(e,t){(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.LB)("meta-"+e),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.LB)("code-"+e),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.LB)("depend-"+e);let n=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{});(0,_native__WEBPACK_IMPORTED_MODULE_8__.Hn)(n,e,void 0),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.all",n),markDirty(),t()}function installFromGID(e,t,n){installFromUrl(e.getAsURL(),t,n,e)}function installFromUrl(e,t=(()=>{}),n=(()=>{}),s=GIDURL.NIL){(0,_crossorigin__WEBPACK_IMPORTED_MODULE_3__.e)(e,(()=>n("安装失败，网络请求失败")),(e=>{let o=addModule(e,s);"string"==typeof o?n(o):t(o),resortDependency()}))}function isDirty(){return dirty}function markDirty(){dirty=!0}function coreModEval(code){return new Promise(((resolve,reject)=>{try{eval(code),resolve(0)}catch(e){reject(e)}}))}},517:(e,t,n)=>{n.d(t,{Z:()=>c});var s=n(204),o=n(827),a=n(160),i=n(23),r=n(152);function l(){(0,i.Ys)("title").html("MCBBS Loader - 配置页面"),(0,i.Ys)("div[class='bm bw0']").html("<span style='font-size:1.5rem'>设置中心</span>&nbsp;&nbsp;<button id='saveconfig' type='button' class='pn pnc'><span>保存</span></button>&nbsp;<span style='color:#df307f'>您的设置应当会自动保存，如果没有，单击此按钮来保存。</span> <br/><div id='config_div'></div>"),(0,i.Ys)("#saveconfig").on("click",d),function(){if((0,i.Ys)(".a").removeClass("a"),(0,i.Ys)("#manage_config").parent().addClass("a"),!o.a.emitCancelable("ConfigPagePreRender")){for(let e of(0,s.vo)("CDT")){let t=`<label style='font-size:14px' for='confval-${e.id}-${e.stgid}'>\n        <span style='font-size:18px;color:#5d2391'>\n          <b>${e.name} </b>\n        </span>\n        (${e.id}:${e.stgid})\n        <br/>\n        <span style='color:#df307f'>${e.desc}</span>\n      </label>`;if("checkbox"==e.type?t=`<span style='font-size:14px'>\n          <span style='font-size:18px;color:#5d2391'>\n            <i id='confval-${e.id}-${e.stgid}' class='chkbox fa fa-check-square'></i>\n            &nbsp;\n            <b>${e.name}</b>\n          </span>\n          (${e.id}:${e.stgid})\n          <br/>\n          <span style='color:#df307f'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${e.desc}</span>\n          <div id='conferr-${e.id}-${e.stgid}'></div></span>\n          <br/>\n        </span>`:"textarea"==e.type?t+=`<br/>\n        <div id='conferr-${e.id}-${e.stgid}'></div>\n        <textarea id='confval-${e.id}-${e.stgid}' style="width: 99%;" class="loadertextconf"></textarea>\n        <br/>`:"button"==e.type?t+=`<br/>\n        <div id='conferr-${e.id}-${e.stgid}'></div>\n        <button style='float: right;' class='pn pnc' id='confval-${e.id}-${e.stgid}'>${e.value}</button>\n        <br/>`:t+=`<div style='height: 17px;'>\n          <input type='text' class='px loadertextconf' id='confval-${e.id}-${e.stgid}'/>\n          <div id='conferr-${e.id}-${e.stgid}'></div>\n          <br/>\n        </div>`,(0,i.Ys)("#config_div").append(t),"checkbox"==e.type){let t=_(e.id,e.stgid,!1)?"chkbox fa fa-check-square":"chkbox fa fa-square";document.getElementById(`confval-${e.id}-${e.stgid}`).className=t}else{let t=_(e.id,e.stgid,"");(0,i.Ys)(`[id='confval-${e.id}-${e.stgid}']`).val(t)}let n=document.getElementById(`confval-${e.id}-${e.stgid}`);"button"==e.type?n.onclick=e.check:(n.oninput=function(){let t=this;(0,i.Ys)(`#conferr-${e.id}-${e.stgid}`).html(e.check("checkbox"!=e.type?t.value:"chkbox fa fa-check-square"==t.className)||""),"textarea"==e.type&&(t.rows=t.value.split("\n").length)},n.oninput())}(0,i.Ys)(".chkbox").on("click",(e=>{var t;e.target.className="chkbox fa fa-"+((null===(t=e.target.className)||void 0===t?void 0:t.includes("check-square"))?"check-":"")+"square",e.target.oninput(),d()})),(0,i.Ys)(".loadertextconf").on("blur",d),o.a.emit("ConfigPagePostRender")}}()}function d(){for(let e of(0,s.vo)("CDT"))(0,s.s4)(`configstore-${e.id}-${e.stgid}`,"checkbox"===e.type?document.getElementById(`confval-${e.id}-${e.stgid}`).classList.contains("fa-check-square"):(0,i.Ys)(`[id='confval-${e.id}-${e.stgid}']`).val());(0,a.JV)("设置保存成功！")}function _(e,t,n){return(0,s.o9)(`configstore-${e}-${t}`,n)}const c={createMenu:function(){(0,s.oE)("getConfig",(function(e,t){return _(e,t,void 0)})),i.lP.load((()=>{(0,i.Ys)("div.appl > div.tbn > ul").prepend("<li><a id='manage_config' style='cursor:pointer;' href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=config'>模块选项中心</a></li>"),(0,i.Ys)("#manage_config").on("click",(e=>{(0,r.eT)()||(e.preventDefault(),l(),history.replaceState(null,null,"https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=config"))}))}))},dumpConfigPage:l,createConfigItem:function(e,t,n,o,a,i=(e=>{}),r){let l=(0,s.vo)("CDT"),d={id:e,type:o,stgid:t,name:n,desc:a,check:i,value:r};return l.push(d),(0,s.oE)("CDT",l),d},getConfigVal:_,setConfigVal:function(e,t,n){(0,s.o9)(`configstore-${e}-${t}`,n)}}},601:(e,t,n)=>{n.d(t,{e:()=>o});var s=n(204);function o(e,t=(()=>{}),n=(()=>{}),o="plain"){return(0,s.h0)({method:"GET",url:e,timeout:5e3,ontimeout:()=>t("网络错误：连接超时"),onerror:()=>t("网络错误：没有更多信息"),onload:e=>{if(200!=e.status)t(`错误：${e.status} ${e.statusText}`);else if("json"==o)try{n(JSON.parse(e.responseText))}catch(e){t("JSON解析错误")}else"plain"==o&&n(e.responseText)}})}},23:(e,t,n)=>{n.d(t,{lP:()=>o,Ys:()=>a,fy:()=>i});let s=[];window.addEventListener("load",(()=>{for(let e of s)e();s=null}));class o{constructor(e){this.elements=[];for(let t of e)this.elements.push(t)}static select(e){return new o("string"==typeof e?document.querySelectorAll(e):[e])}static ban(e){let t=document.createElement("span");t.innerHTML=e;let n=e=>{var s;if(["SCRIPT","APPLET","OBJECT","STYLE","LINK"].includes(e.tagName))return e.remove(),void(t.className="banned-by-bbs-loader");for(let n of e.getAttributeNames())n.startsWith("on")&&(e.removeAttribute(n),t.className="banned-by-bbs-loader");e instanceof HTMLLinkElement&&(null===(s=e.href)||void 0===s?void 0:s.startsWith("javascript"))&&(e.href="",t.className="banned-by-bbs-loader");for(let t of e.children)n(t)};return n(t),t.outerHTML}static load(e){return s?s.push(e):setTimeout(e,0),o}each(e){return this.elements.forEach(e),this}remove(){return this.each((e=>e.remove())),this}html(e){var t;return"string"==typeof e?this.each((t=>t.innerHTML=e)):null===(t=this.elements[0])||void 0===t?void 0:t.innerHTML}hasClass(e){var t;return null===(t=this.elements[0])||void 0===t?void 0:t.classList.contains(e)}removeClass(e){return this.each((t=>t.classList.remove(e)))}addClass(e){return this.each((t=>t.classList.add(e)))}css(e,t){var n;return"string"==typeof t?this.each((n=>n.style[e]=t)):null===(n=this.elements[0])||void 0===n?void 0:n.style[e]}val(e){var t;return"string"==typeof e?this.each((t=>t.value=e)):null===(t=this.elements[0])||void 0===t?void 0:t.value}on(e,t){return this.each((n=>n.addEventListener(e,t)))}append(e){return this.each((t=>{if("string"==typeof e){let n=document.createElement("span");for(n.innerHTML=e;n.childNodes[0];)t.append(n.childNodes[0])}else t.append(e)}))}prepend(e){return this.each((t=>{if("string"==typeof e){let n=document.createElement("span");for(n.innerHTML=e;n.childNodes[n.childNodes.length-1];)t.prepend(n.childNodes[n.childNodes.length-1])}else t.prepend(e)}))}after(e){return this.each((t=>{if("string"==typeof e){let n=document.createElement("span");for(n.innerHTML=e;n.childNodes[n.childNodes.length-1];)t.after(n.childNodes[n.childNodes.length-1])}else t.after(e)}))}parent(){let e=[];return this.each((t=>{t.parentElement&&e.push(t.parentElement)})),new o(e)}hide(){return this.css("display","none")}show(){return this.css("display","")}attr(e,t){var n;return"string"==typeof t?this.each((n=>n.setAttribute(e,t))):null===(n=this.elements[0])||void 0===n?void 0:n.getAttribute(e)}data(e,t){return this.attr("data-"+e,t)}foreach(e){for(let t in this.elements)e(t,this.elements[t]);return this}}function a(e){return o.select(e)}function i(e){return e?e.trim():""}},585:(e,t,n)=>{n.d(t,{M:()=>o});let s=Math.floor(1048576*Math.random()*1048576*1048576).toString(16);function o(){return s}},313:(e,t,n)=>{n.d(t,{Z:()=>g});var s=n(644),o=n(152),a=n(455),i=n(624),r=n(204),l=n(160),d=n(601),_=n(517),c=n(23);const p=new Map;function u(e,t,n,s){return`<li id='${e.id}'>\n    <div style='display:inline;'>\n      <img src='${e.icon||""}' width='50' height='50' style="vertical-align:middle;float:left;"/>\n      <div style="height: 8em">\n        &nbsp;&nbsp;\n        <span style='font-size:18px;color:${s}'>\n          <strong>${e.name||"Nameless"}</strong>\n        </span>\n        &nbsp;&nbsp;&nbsp;\n        <span id='vtag-${e.id}' style='font-size:12px;color:#150029;'>\n          ${e.id||"loader.nameless"}@${(e.version||"1.0.0")+(t?"&nbsp;<span style='color:#ff0000'><b>[核心模组]</b></span>":"")+(n?"&nbsp;<span style='color:#0000ff'><b>[早期加载]</b></span>":"")}\n          <span style='color:#df307f;${(0,o.BR)().includes(e.id)?"":"display: none;"}'>\n            [依赖关系原因停用]\n          </span>\n        </span>\n        <br/>\n          &nbsp;&nbsp;\n        <span style='font-size:16px;color:#df307f;'>${e.author||"Someone"}</span>\n        <br/>\n        &nbsp;&nbsp;\n        <span style='font-size:12px'>${e.description}</span>\n        <div style="float: right;">\n          <button type='button' class='pn pnc remove' onclick='window.notifyUninstall("${e.id}")'>\n            <strong>删除模块</strong>\n          </button>\n          &nbsp;&nbsp;\n          <button type='button' class='pn pnc onoff' onclick='window.notifyOnOff("${e.id}")'>\n            <strong>${(0,r.o9)("loader.all",{})[e.id]?"禁用":"启用"}</strong>\n          </button>\n          <button type='button' class='pn pnc showsrc' data-mlsource='${e.id}'>\n            <strong>查看源代码</strong>\n          </button>\n        </div>\n      </div>\n    </div>\n  </li>`}function f(e){p.delete(e.get("id")),(0,o.t3)(),m(),(0,c.Ys)("#install_base64").val((0,r.o9)("code-"+e.get("id"),"")),(0,l.OL)({msg:`${c.lP.ban(e.get("name")||e.get("id"))}已成功安装在您的 MCBBS 上。\n      <br/>  \n      以下是有关本次安装的详情：\n      <br/>  \n      &nbsp;&nbsp;软件包类型：Mod\n      <br/>\n      &nbsp;&nbsp;软件包 ID：${c.lP.ban(e.get("id"))}\n      <br/>\n      &nbsp;作者：${c.lP.ban(e.get("author")||"未知")}\n      <br/>\n      &nbsp;&nbsp版本：${c.lP.ban(e.get("version")||"")}`,title:"安装简报",mode:"right"}),(0,l.JV)("成功安装了模块")}function b(e){(0,l.wp)(e,"安装失败",(()=>{}))}function m(){(0,c.Ys)("title").html("MCBBS Loader - 管理页面"),(0,c.Ys)(".a").removeClass("a"),setTimeout((()=>(0,c.Ys)("#loader_manager").parent().addClass("a")),50);let e=(0,o.ul)().replace(/\n/g,"<br>");c.lP.load((()=>{(0,c.Ys)("div[class='bm bw0']").css("user-select","none"),(0,c.Ys)("div[class='bm bw0']").html(`<span style='font-size:1.5rem'>模块管理&nbsp;&nbsp;&nbsp;版本&nbsp;${(0,s.Y)()}\n        <span style="font-size: 0.8em;color:red" >${(0,o.m4)()?"":"<br>依赖关系未解决"}</span>\n        <span style="font-size: 0.8em;color: brown" >${(0,o.eT)()?"<br>当前的设置需要刷新才能生效":""}</span>\n      </span>\n      <br/>\n      <hr/>\n      <span style='${(0,o.m4)()?"display:none;":""}font-size:1rem;'>错误</span>\n      <div id='deperr' style='overflow:auto;color:#ff0000;${(0,o.m4)()?"display:none;":""}'>\n        ${e}\n      </div>\n      <hr style='${(0,o.m4)()?"display:none;":""}'/>`+a.ZP),(0,c.Ys)("#use_mloader").on("click",(()=>(0,c.Ys)("#install_uno").val("MCBBS-Loader:仓库名:模块 ID:main"))),(0,c.Ys)("#use_cv").on("click",(()=>(0,c.Ys)("#install_uno").val("CaveNightingale:CaveNightingale-MCBBS-Modules:模块 ID:master"))),(0,c.Ys)("#use_mext").on("click",(()=>(0,c.Ys)("#install_uno").val("MCBBS-Loader:Integration-Motion:模块 ID:main"))),(0,c.Ys)("#debugmode").on("click",(()=>{"false"==(0,c.Ys)("#debugmode").attr("debug")?((0,c.Ys)("#debugmode").attr("debug","true"),(0,c.Ys)("#install_base64").show(),(0,c.Ys)("#install_uno").hide(),(0,c.Ys)(".srcc").hide()):((0,c.Ys)("#debugmode").attr("debug","false"),(0,c.Ys)("#install_base64").hide(),(0,c.Ys)("#install_uno").show(),(0,c.Ys)(".srcc").show())})),(0,r.oE)("notifyUninstall",(e=>{(0,o.wZ)(e,(()=>{(0,o.t3)(),m(),(0,l.JV)("成功移除了模块")}))})),(0,r.oE)("notifyOnOff",(e=>{let t=(0,r.o9)("loader.all",{});t[e]=!t[e],(0,r.s4)("loader.all",t),(0,o.no)(),(0,o.t3)(),m()})),(0,c.Ys)("#install").on("click",(()=>{var e;let t="true"==(0,c.Ys)("#debugmode").attr("debug")?"#install_base64":"#install_uno",n=(null===(e=(0,c.Ys)(t).val())||void 0===e?void 0:e.toString())||"";try{let e=(0,o.WM)(atob(n));if("string"!=typeof e)f(e);else if(/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(n)){(0,l.JV)("正在获取数据……");try{(0,d.e)(n,b,(e=>{let t=(0,o.WM)(e);"string"!=typeof t?f(t):b(t)}))}catch(e){let t=(0,o.WM)(n);"string"!=typeof t?f(t):(0,o.GK)(o.C5.fromString(n),f,b)}}else{let e=(0,o.WM)(n);"string"!=typeof e?f(e):(0,o.GK)(o.C5.fromString(n),f,b)}}catch(e){if(/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(n)){(0,l.JV)("正在获取数据……");try{(0,d.e)(n,b,(e=>{let t=(0,o.WM)(e);"string"!=typeof t?f(t):b(t)}))}catch(e){let t=(0,o.WM)(n);"string"!=typeof t?f(t):(0,o.GK)(o.C5.fromString(n),f,b)}}else{let e=(0,o.WM)(n);"string"!=typeof e?f(e):(0,o.GK)(o.C5.fromString(n),f,(()=>b("无效 ID 或网络错误，所有安装途径均失败")))}}}));let t=(0,r.o9)("loader.all",{});for(let e of Object.entries(t)){let t=(0,r.o9)("meta-"+e[0],{id:"impossible"}),n=u(t,t.permissions.includes("loader:core"),t.permissions.includes("loader:earlyload"),"#5d2391");(0,c.Ys)("#all_modules").append(n)}(0,c.Ys)(".showsrc").on("click",(e=>{"false"==(0,c.Ys)("#debugmode").attr("debug")&&((0,c.Ys)("#debugmode").attr("debug","true"),(0,c.Ys)("#install_base64").show(),(0,c.Ys)("#install_uno").hide(),(0,c.Ys)(".srcc").hide());let t=(0,c.Ys)(e.target).data("mlsource")||(0,c.Ys)(e.target).parent().data("mlsource");t&&(0,c.Ys)("#install_base64").val((0,r.o9)("code-"+t,""))})),(0,c.Ys)("#all_modules > li").foreach(((e,t)=>{let n=(0,c.Ys)(t).attr("id")||"loader.impossible",s=(0,r.o9)("meta-"+n);p.get(n)!=s.version&&(p.set(n,s.version),(0,i.P)(s,((e,t,a)=>{if(p.get(n)!=s.version)return;let i;p.delete(n);let r=!1;switch(e){case"latest-api-too-early":i="<span style='color:#f16d2e'><b>[已过期]</b></span>";break;case"latest-no-update-url":case"latest-no-version":i="<span style='color:#636363'><b>[本地]</b></span>";break;case"latest-version-equal-or-earlier":i="<span style='color:#df307f'><b>[最新]</b></span>";break;default:e.startsWith("latest")||(i="<span style='color:#ffaec8'><b>[有可用更新]</b></span>",r=!0)}let d=(0,c.Ys)(`[id='vtag-${s.id}']`).html();d=`${d}${r?"&nbsp;->&nbsp;"+a:""}&nbsp;${i}`,(0,c.Ys)(`[id='vtag-${s.id}']`).html(d),r&&(0,c.Ys)(`[id='vtag-${s.id}']`).parent().append(`<button type='button' style='float:right' class='pn pnc update' data-mlurl='${e}'>\n                <strong>更新模块</strong>\n              </button>`),(0,c.Ys)(".update").on("click",(e=>{let t=(0,c.Ys)(e.target).data("mlurl")||(0,c.Ys)(e.target).parent().data("mlurl");t&&((0,c.Ys)(e.target).data("mlurl")?(0,c.Ys)(e.target).remove():(0,c.Ys)(e.target).parent().remove(),(0,o.no)(),(0,o.qA)(t,(()=>{m();let e=(0,c.Ys)(`[id='vtag-${s.id}']`).html();e=e.replace('<span style="color:#ffaec8"><b>[有可用更新]</b></span>',"<span style='color:#df307f'><b>[已更新]</b></span>"),(0,c.Ys)(`[id='vtag-${s.id}']`).html(e)}),(()=>{let e=(0,c.Ys)(`[id='vtag-${s.id}']`).html();e=e.replace('<span style="color:#ffaec8"><b>[有可用更新]</b></span>',"<span style='color:#ec1c24'><b>[更新失败]</b></span>"),(0,c.Ys)(`[id='vtag-${s.id}']`).html(e)}),o.C5.fromString(s.gid)),(0,l.JV)("已尝试更新，更新效果在更新完成后刷新页面才会显示。"))}))})))}))}))}const g={createBtn:function(){c.lP.load((()=>{(0,c.Ys)("ul.user_info_menu_btn").append("<li><a href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=manager'>MCBBS 模块管理</a></li>")}))},createMenu:function(){window.location.href.startsWith("https://www.mcbbs.net/home.php?mod=spacecp")&&(c.lP.load((()=>{(0,c.Ys)("div.appl > div.tbn > ul").prepend("<li><a id='loader_manager' href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=manager'style='cursor:pointer;'>模块管理</a></li>"),(0,c.Ys)("#loader_manager").on("click",(e=>{(0,o.eT)()||(e.preventDefault(),m(),history.replaceState(null,null,"https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=manager"))}))})),_.Z.createMenu())},dumpManager:m,onInstall:f,onFailure:b}},455:(e,t,n)=>{n.d(t,{QD:()=>s,ZP:()=>o,k7:()=>a,Uk:()=>i});const s="https://attachment.mcbbs.net/data/myattachment/forum/202104/30/181947s2ofgj3spsfj1pss.png",o="<span style='font-size:1rem'>已安装的模块</span>\n  <br/>\n  <div style='overflow:auto;'>\n    <ul id='all_modules'></ul>\n  </div>\n  <hr/>\n  <span style='font-size:1rem'>安装新模块</span>\n  <button debug='false' type='button' id='debugmode' class='pn pnc'>\n    <strong>调试模式</strong>\n  </button>\n  <br/>\n  <textarea style=\"display:none;font-family:'Fira Code','Courier New',monospace;background-color:#fbf2db;width:90%;height:150px;overflow:auto;word-break:break-all;resize:vertical;\" placeholder='BASE64 编码，URL 或 JavaScript 代码……' id='install_base64'></textarea>\n  <br/>\n  <input style='width:90%;font-family:\"Fira Code\",\"Courier New\",monospace;' type='text' class='px' id='install_uno' placeholder='使用 GID 安装……'/>\n  <br/>\n  <br/>\n  <button class='pn pnc' type='button' id='install'>\n    <strong>安装</strong>\n  </button>\n  <br/>\n  <br/>\n  <br/>\n  <button class='pn pnc srcc' type='button' id='use_cv'>\n    <strong>快速使用 洞穴夜莺 源（CaveNightingale）</strong>\n  </button>\n  <span class='srcc'>\n    洞穴夜莺的软件源中包含许多轻松使用模块，\n    <a id='preview_cv' style='color:#df307f'href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=repopreview#gitee%3ACaveNightingale%3ACaveNightingale-MCBBS-Modules%3Amanifest%3Av2' target='_blank'>\n      预览该软件源\n    </a>\n    。\n  </span>\n  <br/>\n  <br/>\n  <button class='pn pnc srcc' type='button' id='use_mext'>\n    <strong>快速使用 MExt 整合运动 源（MExt-IM）</strong>\n  </button>\n  <span class='srcc'>\n    MExt 整合运动的软件源中包括了许多适合老用户的 MExt 模块，\n    <a id='preview_mext' style='color:#df307f' href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=repopreview#MCBBS-Loader%3AIntegration-Motion%3Amanifest%3Amain' target='_blank'>\n      预览该软件源\n    </a>。\n  </span>\n  <br/>\n</span>",a="&nbsp;&nbsp;\n  <input class=\"px\" id=\"viewsrc\" type=\"text\" style=\"width: 50%\" placeholder=\"输入新的软件源地址来加载预览\"/>\n  &nbsp;\n  <button type=\"button\" id=\"loadview\" class=\"pn pnc\">\n    <strong>加载预览</strong>\n  </button>\n  <br/>\n  <hr/>\n  <span style='font-size:1rem'>该软件源中的模块</span>\n  <span style='float: right;'>\n    <a href='javascript:;' style='color: #524229;' id='select-all-btn'>反选</a>\n    <a href='javascript:;' style='color: #524229;' id='apply-changes-btn'>应用</a>\n  </span>\n  <br/>\n  <div style='overflow:auto;'>\n    <ul id='all_modules'></ul>\n  </div>\n  <hr/>",i="#_popbg {\n  user-select: none;\n  cursor: default;\n  width: 100%;\n  height: 50px;\n  background-color: #02020275;\n  position: fixed;\n  bottom: -50px;\n  text-align: center;\n  color: #ffffff;\n}\n\ninput.loadertextconf {\n  background-color: white;\n  float: right;\n  width:50%;\n}"},624:(e,t,n)=>{n.d(t,{P:()=>i});var s=n(644),o=n(152),a=n(601);function i(e,t){let n=e.id||"loader.nameless",i=/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g;if(e.updateURL||e.gid){let r=e.updateURL?i.test(e.updateURL)?e.updateURL:o.C5.fromString(e.updateURL,o.C5.fromString(e.gid)).getAsURL():o.C5.fromString(e.gid).getAsURL();(0,a.e)(r,(()=>t("latest-network-err")),(a=>{let i=new Map;if((0,o.jw)(a,i),i.get("id")!=n)t("latest-diff-id");else if("string"==typeof i.get("version")){let n=i.get("version")||"1.0.0",o=e.version||"1.0.0";if(function(e,t){let n=e.split("."),s=t.split(".");if(1==n.length)return parseInt(n[0])>parseInt(s[0]||"0");for(let e=0;e<n.length;e++){if(parseInt(n[e])>parseInt(s[e]||"0"))return!0;if(parseInt(n[e])<parseInt(s[e]||"0"))return!1}return!1}(n,o)){let a=i.get("apiVersion");"string"==typeof a&&a!=String((0,s.Y)())?t("latest-api-too-early"):t(e.updateURL,o,n)}else t("latest-version-equal-or-earlier")}else t("latest-no-version")}))}else t("latest-no-update-url")}},647:(e,t,n)=>{n.d(t,{Z:()=>_});var s=n(152),o=n(313),a=n(204),i=n(160),r=n(455),l=n(601),d=n(23);const _={dumpPreview:function e(t){(0,d.Ys)("title").html("MCBBS Loader - 软件源");let n=s.C5.fromString(t);(0,d.Ys)(".a").removeClass("a");let _=new Set;(0,d.Ys)("div[class='bm bw0']").css("user-select","none").html(`<span style='font-size:1.0rem'>正在预览软件源 ${t}</span>`+r.k7),(0,d.Ys)("#viewsrc").val(t),(0,d.Ys)("#loadview").on("click",(()=>{open("https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=repopreview#"+encodeURIComponent(s.C5.fromString((0,d.Ys)("#viewsrc").val(),n).asString()),"_self"),e(s.C5.fromString((0,d.Ys)("#viewsrc").val(),n).asString())})),function(e,t){(0,l.e)(e.getAsURL(".json"),(e=>(0,d.Ys)("#all_modules").html("无法显示该软件源的预览。<br/>"+e)),(e=>{if("object"!=typeof e)(0,d.Ys)("#all_modules").html("无法显示该软件源的预览。<br/>无效的JSON");else{for(let[t,n]of Object.entries(e)){let n=e[t];n.id=n.id||"impossible",n.name=n.name||"Nameless",n.author=n.author||"Someone",n.description=n.description||"No description provided.",n.permissions=n.permissions||"";let s=n.permissions.includes("loader:core"),o=n.permissions.includes("loader:earlyload"),i=null!=(0,a.o9)("meta-"+n.id),l=i?"#575757":"#5d2391",_=i?"&nbsp;<span style='color:#575757'><b>[已安装]</b></span>":"",c=`<li id='${n.id}'>\n          <div style='display:inline;'>\n            <img src='${n.icon||r.QD}' width='50' height='50' style="vertical-align:middle;float:left;"/>\n            <div style="height: 8em">\n              &nbsp;&nbsp;\n              <span style='font-size:18px;color:${l}'>\n                <strong>${n.name||"Nameless"}</strong>\n              </span>\n              &nbsp;&nbsp;&nbsp;\n              <span id='vtag-${n.id}' style='font-size:12px;color:#150029;'>\n                ${n.id}@${(n.version||"1.0.0")+(s?"&nbsp;<span style='color:#ff0000'><b>[核心模块]</b></span>":"")+(o?"&nbsp;<span style='color:#0000ff'><b>[早期加载]</b></span>":"")+_}\n              </span>\n              <br/>\n              &nbsp;&nbsp;\n              <span style='font-size:16px;color:#df307f;'>\n                ${n.author||"Someone"}\n              </span>\n              <br/>\n              &nbsp;&nbsp;\n              <span style='font-size:12px'>\n                ${n.description}\n              </span>\n              <input type='checkbox' class='fast-install-chk' style='float: right;' gtar='${n.gid}'/>\n              <button class='pn pnc insremote' style='float:right;' data-gtar='${n.gid}'>\n                <strong>安装/更新</strong>\n              </button>\n            </div>\n          </div>\n        </li>`;(0,d.Ys)("#all_modules").append(c)}(0,d.Ys)(".insremote").on("click",(e=>{let t=null!=e.target.getAttribute("data-gtar")?e.target:e.target.parentElement;(0,s.GK)(s.C5.fromString(t.getAttribute("data-gtar"),n),(e=>o.Z.onInstall(e)),(e=>o.Z.onFailure(e)))}));let t=!1;(0,d.Ys)(".fast-install-chk").on("click",(e=>{t?e.preventDefault():e.target.checked?_.add(e.target.getAttribute("data-gtar")):_.delete(e.target.getAttribute("data-gtar"))})),(0,d.Ys)("#apply-changes-btn").on("click",(()=>{if(!_.size)return;if(t)return;t=!0;let e=[],a=[],r=()=>{if((0,s.t3)(),e.length+a.length==_.size){let n=`成功安装了 ${e.length} 个模块:`;for(let t of e)n+="<br>&nbsp;&nbsp;&nbsp;&nbsp;"+t.get("name");if(a.length){n+=`<br>未能安装 ${a.length} 个模块:`;for(let[e,t]of a)n+=`<br>&nbsp;&nbsp;&nbsp;&nbsp;${e}&nbsp;&nbsp;&nbsp;&nbsp${t}`;(0,i.wp)(n,"安装失败",(()=>o.Z.dumpManager()))}(0,i.s$)(n,"安装成功",(()=>o.Z.dumpManager())),t=!1}};_.forEach((t=>{(0,s.GK)(s.C5.fromString(t,n),(t=>{e.push(t),r()}),(e=>{a.push([t,e]),r()}))})),(0,i.JV)("安装中，请稍后")})),(0,d.Ys)("#select-all-btn").on("click",(e=>{t||(0,d.Ys)(".fast-install-chk").each((e=>e.click()))}))}}),"json")}(n)}}},487:(e,t,n)=>{function s(){(async()=>{let e=new MutationObserver((e=>{for(let n of e)"childList"==(t=n).type&&(t.addedNodes.length>0&&(e=>{switch(e.target.nodeName){case"DIV":void 0!==e.target.id&&(e.target.id.lastIndexOf("threadPreview_")>=0?"SPAN"==e.addedNodes[0].nodeName&&" 请稍候..."==e.addedNodes[0].innerText&&e.target.dispatchEvent(new CustomEvent("ThreadPreviewPreOpen",{bubbles:!0})):e.addedNodes.length>=3&&e.target.id.lastIndexOf("post_")>=0?"A"==e.addedNodes[0].nodeName&&"newpost"==e.addedNodes[0].name&&null!=e.addedNodes[0].parentNode&&e.target.dispatchEvent(new CustomEvent("ThreadFlushFinished",{bubbles:!0})):"append_parent"==e.target.id?"DIV"==e.addedNodes[0].nodeName&&("fwin_rate"==e.addedNodes[0].id?e.addedNodes[0].dispatchEvent(new CustomEvent("RateWindowPreOpen",{bubbles:!0})):"fwin_reply"==e.addedNodes[0].id?e.addedNodes[0].dispatchEvent(new CustomEvent("ReplyWindowPreOpen",{bubbles:!0})):void 0!==e.addedNodes[0].id&&e.addedNodes[0].id.lastIndexOf("fwin_miscreport")>=0&&e.addedNodes[0].dispatchEvent(new CustomEvent("ReportWindowPreOpen",{bubbles:!0}))):""===e.target.id&&null!=e.target.parentElement&&"postlistreply"==e.target.parentElement&&e.target.dispatchEvent(new CustomEvent("NewReplyAppended",{bubbles:!0})));break;case"A":"#text"==e.addedNodes[0].nodeName&&"undefined"==typeof tid&&("正在加载, 请稍后..."==e.addedNodes[0].nodeValue?e.target.dispatchEvent(new CustomEvent("ThreadsListLoadStart",{bubbles:!0})):"下一页 »"==e.addedNodes[0].nodeValue&&e.target.dispatchEvent(new CustomEvent("ThreadsListLoadFinished",{bubbles:!0})));break;case"TD":"fwin_content_rate"==e.target.id&&"DIV"==e.addedNodes[0].nodeName&&"floatlayout_topicadmin"==e.addedNodes[0].id&&e.target.dispatchEvent(new CustomEvent("RateWindowOpened",{bubbles:!0})),"fwin_content_reply"==e.target.id&&"H3"==e.addedNodes[0].nodeName&&"fctrl_reply"==e.addedNodes[0].id&&e.target.dispatchEvent(new CustomEvent("ReplyWindowOpened",{bubbles:!0})),void 0!==e.target.id&&e.target.id.lastIndexOf("fwin_content_miscreport")>=0&&"H3"==e.addedNodes[0].nodeName&&e.addedNodes[0].id.lastIndexOf("fctrl_miscreport")>=0&&e.target.dispatchEvent(new CustomEvent("ReportWindowOpened",{bubbles:!0}))}})(t),t.removedNodes.length>0&&(e=>{switch(e.target.nodeName){case"TBODY":void 0!==e.target.id&&e.target.id.lastIndexOf("normalthread_")>=0&&e.target.dispatchEvent(new CustomEvent("ThreadPreviewClosed",{bubbles:!0}));break;case"DIV":void 0!==e.target.id&&e.target.id.lastIndexOf("threadPreview_")>=0?"SPAN"==e.removedNodes[0].nodeName&&" 请稍候..."==e.removedNodes[0].innerText&&e.target.dispatchEvent(new CustomEvent("ThreadPreviewOpened",{bubbles:!0})):e.removedNodes.length>=3&&e.target.id.lastIndexOf("post_")>=0?"A"==e.removedNodes[0].nodeName&&"newpost"==e.removedNodes[0].name&&null!=e.removedNodes[0].parentNode&&e.target.dispatchEvent(new CustomEvent("ThreadFlushStarted",{bubbles:!0})):"append_parent"==e.target.id&&"DIV"==e.removedNodes[0].nodeName&&("fwin_rate"==e.removedNodes[0].id?e.target.dispatchEvent(new CustomEvent("RateWindowClosed",{bubbles:!0})):"fwin_reply"==e.removedNodes[0].id?e.target.dispatchEvent(new CustomEvent("ReplyWindowClosed",{bubbles:!0})):void 0!==e.removedNodes[0].id&&e.removedNodes[0].id.lastIndexOf("fwin_miscreport")>=0&&e.target.dispatchEvent(new CustomEvent("ReportWindowClosed",{bubbles:!0})))}})(t));var t}));document.addEventListener("DOMContentLoaded",(()=>{unsafeWindow.MExt||e.observe(document.body,{childList:!0,subtree:!0})})),addEventListener("DiscuzAjaxPostPost",(()=>document.dispatchEvent(new CustomEvent("DiscuzAjaxPostFinished",{bubbles:!0})))),addEventListener("DiscuzAjaxPostGet",(()=>document.dispatchEvent(new CustomEvent("DiscuzAjaxGetFinished",{bubbles:!0}))))})()}n.d(t,{Q:()=>s})},827:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>loadEvents,a:()=>LoaderEvent});class LoaderEvent extends Event{constructor(e,t,n=!1){super(e,{bubbles:!0,cancelable:n}),this.name=e;for(let[e,n]of Object.entries(t))this[e]=n}static emit(e,t={}){document.dispatchEvent(new LoaderEvent(e,t))}static emitCancelable(e,t={}){let n=new LoaderEvent(e,t,!0);return document.dispatchEvent(n),n.defaultPrevented}}function loadEvents(){(async()=>{if(void 0!==unsafeWindow.ajaxpost){const __ajaxpost=unsafeWindow.ajaxpost;unsafeWindow.ajaxpost=(formid,showid,waitid,showidclass,submitbtn,recall)=>{LoaderEvent.emitCancelable("DiscuzAjaxPrePost",{formid,showid,waitid,showidclass,submitbtn,recall})||__ajaxpost(formid,showid,waitid,showidclass,submitbtn,(()=>{"function"==typeof recall?recall():eval(recall),LoaderEvent.emit("DiscuzAjaxPostPost",{formid,showid,waitid,showidclass,submitbtn,recall})}))}}if(void 0!==unsafeWindow.ajaxget){const __ajaxget=unsafeWindow.ajaxget;unsafeWindow.ajaxget=(url,showid,waitid,loading,display,recall)=>{LoaderEvent.emitCancelable("DiscuzAjaxPreGet",{url,showid,waitid,loading,display,recall})||__ajaxget(url,showid,waitid,loading,display,(()=>{"function"==typeof recall?recall():eval(recall),LoaderEvent.emit("DiscuzAjaxPostGet",{url,showid,waitid,loading,display,recall})}))}}if(void 0!==unsafeWindow.previewThread){let e=unsafeWindow.previewThread;unsafeWindow.previewThread=(t,n)=>{LoaderEvent.emitCancelable("ToggleThreadPreview",{tid:t,tbody:n})||e(t,n)}}if(void 0!==unsafeWindow.showWindow){let e=unsafeWindow.showWindow;unsafeWindow.showWindow=(t,n,s,o,a)=>{LoaderEvent.emitCancelable("WindowPreLoad",{win:t,url:n,method:s,cache:o,menuv:a})||e(t,n,s,o,a)}}if(void 0!==unsafeWindow.showMenu){let e=unsafeWindow.showMenu;unsafeWindow.showMenu=t=>{LoaderEvent.emitCancelable("MenuPreShow",{detail:t})||(e(t),LoaderEvent.emit("MenuPostShow",{detail:t}))}}if(void 0!==unsafeWindow.hideMenu){let e=unsafeWindow.hideMenu;unsafeWindow.hideMenu=(t,n)=>{LoaderEvent.emitCancelable("MenuPreHide",{attr:t,mtype:n})||(e(t,n),LoaderEvent.emit("MenuPostHide",{attr:t,mtype:n}))}}})()}},160:(e,t,n)=>{n.d(t,{wp:()=>a,JV:()=>r,s$:()=>o,OL:()=>i,NE:()=>l});var s=n(321);function o(e,t,n){(0,s.LP)().showDialog(e,"right",t,n)}function a(e,t,n){(0,s.LP)().showDialog(e,"alert",t,n)}function i(e){showDialog(e.msg,e.mode,e.title,e.onClick,e.cover,e.onCancel,e.confirmText,e.cancelText,e.closeTime,e.locationTime)}function r(e){(0,s.LP)().showError(e)}function l(e,t,n){let s="fwin_"+e,o=$(s),a="";o||(o=document.createElement("div"),o.id=s,o.className="fwinmask",o.style.opacity=0,o.style.pointerEvents="none",document.getElementById("append_parent").appendChild(o),evt=' style="cursor:move" onmousedown="dragMenu($(\''+s+"'), event, 1)\" ondblclick=\"hideWindow('"+e+"')\"",a='<style type="text/css">object{visibility:hidden;}</style>',o.innerHTML=a+'<table cellpadding="0" cellspacing="0" class="fwin"><tr><td class="t_l"></td><td class="t_c"'+evt+'></td><td class="t_r"></td></tr><tr><td class="m_l"'+evt+')">&nbsp;&nbsp;</td><td class="m_c" id="fwin_content_'+e+'"></td><td class="m_r"'+evt+'"></td></tr><tr><td class="b_l"></td><td class="b_c"'+evt+'></td><td class="b_r"></td></tr></table>',t instanceof Text||t instanceof HTMLElement?document.getElementById("fwin_content_"+e).appendChild(t):document.getElementById("fwin_content_"+e).innerHTML=t),function(){hideMenu("fwin_dialog","dialog");let t={mtype:"win",menuid:s,duration:3,pos:"00",zindex:JSMENU.zIndex.win,drag:"",cache:-1};for(e in n)t[e]=n[e];showMenu(t)}(),doane()}},321:(e,t,n)=>{function s(e,t,n){e[t]=n}function o(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!1,configurable:!1})}function a(){return unsafeWindow||window}function i(){return{GM_addStyle,GM_deleteValue,GM_download,GM_getResourceText,GM_getResourceURL,GM_getValue,GM_listValues,GM_log,GM_notification,GM_setClipboard,GM_setValue}}n.d(t,{Hn:()=>s,LP:()=>a,VI:()=>o,rj:()=>i})},204:(e,t,n)=>{function s(e){GM_deleteValue(e)}function o(e,t){GM_setValue(e,t)}function a(e,t){return GM_getValue(e,t)}function i(e){GM_log(e)}function r(e,t){unsafeWindow[e]=t}function l(e){return unsafeWindow[e]}function d(e){return GM_xmlhttpRequest(e)}n.d(t,{LB:()=>s,s4:()=>o,o9:()=>a,n$:()=>i,h0:()=>d,oE:()=>r,vo:()=>l})}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var _libs_codeload__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(152),_libs_manager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(313),_libs_configpage__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(517),_libs_updator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(624),_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(204),_libs_native__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(321),_api_STDAPI__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(644),_api_NTEVT__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(487),_libs_encrypt__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(585),_libs_viewrepo__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(647),_libs_static__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(455),_api_STDEVT__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(827),_libs_domutils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(23);function fixMuteScreen(){(0,_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.Ys)("#ct").hasClass("wp cl w")&&((0,_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.Ys)("#ct").remove(),(0,_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.Ys)("#wp").html('<div id="pt" class="bm cl">\n    <div class="z">\n    <a href="./" class="nvhm" title="首页">Minecraft(我的世界)中文论坛</a> <em>›</em>\n    <a href="home.php?mod=spacecp">设置</a> <em>›</em>个人资料\n    </div>\n    </div><div id="ct" class="ct2_a wp cl">\n    <div class="mn">\n    <div class="bm bw0" style="user-select: none;"></div>\n    </div>\n    <div class="appl"><div class="tbn">\n    <h2 class="mt bbda">设置</h2>\n    <ul>'))}function main(){(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.oE)("__onExtraScriptLoaded",(e=>e())),_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.lP.load(_api_NTEVT__WEBPACK_IMPORTED_MODULE_10__.Q).load(_api_STDEVT__WEBPACK_IMPORTED_MODULE_7__.w).load((()=>{(0,_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.Ys)("head").append("<link type='text/css' rel='stylesheet'\n          href='https://cdn.staticfile.org/font-awesome/5.15.1/css/all.min.css'/>").append("<link type='text/css' rel='stylesheet'\n          href='https://cdn.staticfile.org/font-awesome/5.15.1/css/v4-shims.min.css'/>").append(`<style id="mcbbs-loader-common-css">${_libs_static__WEBPACK_IMPORTED_MODULE_11__.Uk}</style>`),(0,_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.Ys)("#debuginfo").after(`<br/><span>With MCBBS Loader Version ${(0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_4__.Y)()}.<br/>MCBBS Loader 是独立的项目，与我的世界中文论坛没有从属关系</span>`)})),(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.n$)("[MCBBS Loader] 加载器和 API 版本： Min-"+(0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_4__.Y)()),(0,_libs_native__WEBPACK_IMPORTED_MODULE_12__.VI)((0,_libs_native__WEBPACK_IMPORTED_MODULE_12__.LP)(),"forkAPI_"+(0,_libs_encrypt__WEBPACK_IMPORTED_MODULE_5__.M)(),_api_STDAPI__WEBPACK_IMPORTED_MODULE_4__.u),(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.oE)("CDT",[]);let all=(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.o9)("loader.all",{});for(let[id,enabled]of Object.entries(all))if(enabled&&-1!=(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.o9)("meta-"+id,{}).permissions.indexOf("loader:earlyload"))try{eval(`(() => {let MCBBS = null; ${(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.o9)("code-"+id)}})()`)}catch(e){console.error(e)}_libs_domutils__WEBPACK_IMPORTED_MODULE_8__.lP.load((()=>{let e=(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.o9)("loader.sortedModuleList")||(0,_libs_codeload__WEBPACK_IMPORTED_MODULE_0__.t3)();for(let t of e)(0,_libs_codeload__WEBPACK_IMPORTED_MODULE_0__.uk)(t,(0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.o9)("code-"+t)),(e=>{(0,_libs_updator__WEBPACK_IMPORTED_MODULE_3__.P)((0,_libs_usfunc__WEBPACK_IMPORTED_MODULE_9__.o9)("meta-"+e,""),((t,n,s)=>{t.startsWith("latest")||console.log(`[MCBBS Loader] 有更新可用，模块 ${e} 具有新版本 ${s}，当前安装的版本为 ${n}。`)}))})(t);_libs_manager__WEBPACK_IMPORTED_MODULE_1__.Z.createBtn(),_libs_manager__WEBPACK_IMPORTED_MODULE_1__.Z.createMenu();let t=String(window.location.search);if(/bbsmod=repopreview/i.test(t)){fixMuteScreen();let e=window.location.hash.indexOf("#");_libs_viewrepo__WEBPACK_IMPORTED_MODULE_6__.Z.dumpPreview(-1!=e?decodeURIComponent(window.location.hash.substring(1)):"MCBBS-Loader/examplemod@main")}else/bbsmod=manager/i.test(t)?(fixMuteScreen(),_libs_manager__WEBPACK_IMPORTED_MODULE_1__.Z.dumpManager()):/bbsmod=config/i.test(t)&&(fixMuteScreen(),setTimeout((()=>_libs_configpage__WEBPACK_IMPORTED_MODULE_2__.Z.dumpConfigPage()),0))}))}frameElement||main()})()})();