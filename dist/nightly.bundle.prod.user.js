// ==UserScript==
// @name         MCBBS Loader
// @namespace    https://mcbbs-loader.xuogroup.top
// @version      1.2.0
// @description  Load custom modules into MCBBS!
// @author       mcbbs-loader
// @match        https://www.mcbbs.net/*
// @run-at       document-start
// @updateURL    https://cdn.jsdelivr.net/gh/MCBBS-Loader/MCBBS-Loader-Core@main/dist/nightly.bundle.prod.user.js
// @grant        unsafeWindow
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_listValues
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_log
// @grant        GM_getResourceText
// @grant        GM_getResourceURL
// @grant        GM_download
// @grant        GM_notification
// @grant        GM_setClipboard
// @grant        GM_xmlhttpRequest
// @connect      gitee.com
// @connect      github.com
// @connect      cdn.jsdelivr.net
// @connect      mcbbs.net
// @connect      *
// ==/UserScript==

(()=>{"use strict";var __webpack_modules__={644:(e,t,n)=>{n.d(t,{Y:()=>o});var s=n(204),a=n(321);function o(){return 2}n(152),n(517),n(827),n(160),n(601),(0,a.rj)(),(0,s.o9)("loader.all",{}),(0,s.oE)("MIDT",{})},152:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C5:()=>GIDURL,WM:()=>addModule,uk:()=>mountCode,wZ:()=>deleteModule,qA:()=>installFromUrl,jw:()=>parseMeta,eT:()=>isDirty,no:()=>markDirty,t3:()=>resortDependency,BR:()=>getTmpDisabled,ul:()=>getDependencyError,m4:()=>isDependencySolved,GK:()=>installFromGID});var _api_STDAPI__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(644),_encrypt__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(585),_native__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(321),_usfunc__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(204),_manager__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(313),_static__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(455),_crossorigin__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(601),_craftmcbbs_craft_ui__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(160),_domutils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(23);class GIDURL{constructor(e,t,n,s,a,o=GIDURL.NIL){this.service="~"==e?o.service:e,this.version="~"==t?o.version:t,this.repo="~"==n?o.repo:n,this.file="~"==s?o.file:s,this.provider="~"==a?o.provider:a}static fromString(e,t=GIDURL.NIL){let n=e.split(":");switch(n.length){case 1:return new GIDURL("github","",e,e,"MCBBS-Loader",t);case 2:return new GIDURL("github","",n[1],n[1],n[0],t);case 3:return new GIDURL("github","",n[1],n[2],n[0],t);case 4:return new GIDURL("github",n[3],n[1],n[2],n[0],t);case 5:return new GIDURL(n[0],n[4],n[2],n[3],n[1],t);default:return GIDURL.NIL}}getAsURL(e=".js"){return"github"==this.service?`https://cdn.jsdelivr.net/gh/${this.provider}/${this.repo}${this.version?"@":""}${this.version}/${this.file}${e}`:"gitee"==this.service?`https://gitee.com/${this.provider}/${this.repo}/raw/${this.version}/${this.file}${e}`:""}asString(){return[this.service,this.provider,this.repo,this.file,this.version].join(":")}}GIDURL.NIL=new GIDURL("","","","","",null);const STRING_API_VERSION=String((0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_0__.Y)());let dirty=!1,globalDependencyError=null,globalTmpDisabled=null;function getTmpDisabled(){return null==globalTmpDisabled?globalTmpDisabled=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.tmpDisabled",[]):globalTmpDisabled}function getDependencyError(){return null==globalDependencyError?globalDependencyError=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.dependencyError",""):globalDependencyError}function isDependencySolved(){return!getDependencyError().length}function resortDependency(){return resortDependencyInternal((0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{}),"",[])}function resortDependencyInternal(e,t,n){const s={};let a=(e,t)=>(t.beforeHead=s,t.afterHead=s,t.id=e,t),o=new Map,r=[],i=[],l=new Set;for(let[t,n]of Object.entries(e))n&&o.set(t,a(t,JSON.parse((0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("depend-"+t,"{}")))),((0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("meta-"+t,{}).apiVersion||(0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_0__.Y)())!=(0,_api_STDAPI__WEBPACK_IMPORTED_MODULE_0__.Y)()&&deleteModule(t,(()=>{console.log("[MCBBS Loader] 由于 API 版本不兼容，移除了 ID 为 "+t+" 的脚本。\n如有需要，你可以重新安装。"),(0,_craftmcbbs_craft_ui__WEBPACK_IMPORTED_MODULE_4__.JV)("[MCBBS Loader] 由于 API 版本不兼容，移除了 ID 为 "+t+" 的脚本。\n如有需要，你可以重新安装。")}));let d=(e,t)=>{let n={before:e,after:t,beforeNext:e.beforeHead,afterNext:t.afterHead,beforePrev:s,afterPrev:s};n.beforeNext.beforePrev=n.afterNext.afterPrev=n,t.afterHead=e.beforeHead=n};for(o.forEach(((e,n)=>{let s=e.depend;s instanceof Array&&s.forEach((e=>{o.get(e)||(t+=`${n}依赖${e}，但是后者未安装或未启用。\n`,l.add(n))}));let a=e.before;a instanceof Array&&a.forEach((t=>{let n=o.get(t);n&&d(e,n)}));let r=e.after;r instanceof Array&&r.forEach((t=>{let n=o.get(t);n&&d(n,e)}))})),o.forEach((e=>{e.afterHead===s&&r.push(e)}));r.length;){let e=r.pop();for(i.push(e.id);s!=e.beforeHead;)(c=e.beforeHead).afterNext.afterPrev=c.afterPrev,c.beforeNext.beforePrev=c.beforePrev,c.afterPrev.afterNext=c.afterNext,c.beforePrev.beforeNext=c.beforeNext,c===c.after.afterHead&&(c.after.afterHead=c.afterNext),c===c.before.beforeHead&&(c.before.beforeHead=c.beforeNext),s===c.after.afterHead&&r.push(c.after)}var c;o.forEach((e=>{if(e.beforeHead!=s){l.add(e.id),t+=e.id+"要求在";let n=e.beforeHead;for(;n!=s;)t+=n.after.id+(n.beforeNext===s?"":","),n=n.beforeNext;t+="之前加载，然而此要求无法满足。\n"}}));let _=[];return l.forEach((t=>{_.push(t),delete e[t]})),_.length?(t+="已临时停用"+_.toString()+"\n",resortDependencyInternal(e,t,n.concat(_))):(globalTmpDisabled=n,globalDependencyError=t,(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.sortedModuleList",i),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.dependencyError",t),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.tmpDisabled",n),i)}function verifyId(e){return/^[0-9|a-z|A-Z|\.|_]+$/.test(e)}function addModule(e,t=GIDURL.NIL){let n=e.trim();if(!/\/\*( )*MCBBS[ -]*Module/.test(n))return"这不是一个模块";let s=new Map;parseMeta(n,s);let a,o,r,i=e=>{let t=[];for(let n of e){let e=n.trim();e.length&&t.push(e)}return t},l=s.get("depend")||"",d=s.get("id");if(void 0===d)return"未提供 id 数据值";if(!verifyId(d))return"不合要求的 id";let c=[],_={};for(let e of l.split(",")){let t=e.trim();if(t.length)if(t.includes("->")){let e=/^([0-9|a-z|A-Z|\.|_]+) -> ([0-9|a-z|A-Z|\.|_|:|/|%|@|-]+)$/.exec(t);if(!e||3!=e.length)return"依赖地址编写格式错误";c.push(e[1]),_[e[1]]||(_[e[1]]=[]),_[e[1]].push(e[2])}else c.push(t)}l=c.join(",");let p={id:d,permissions:s.get("permissions")||"",name:_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("name")||s.get("id")),author:_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("author")||"Someone"),icon:s.get("icon")||_static__WEBPACK_IMPORTED_MODULE_7__.QD,depend:l,before:a=s.get("before")||"",after:o=s.get("after")||"",description:_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("description")||"No description provided."),updateURL:s.get("updateURL"),apiVersion:r=s.get("apiVersion"),version:s.get("version")?_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.ban(s.get("version")):void 0,gid:t!=GIDURL.NIL?t.asString():s.get("gid")};if((r||STRING_API_VERSION)!=STRING_API_VERSION)return"不支持的 API 版本："+r;if(regMeta(d,p)){(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("code-"+d,n),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("depend-"+d,JSON.stringify({depend:c,before:i(a.split(",")),after:i(o.split(","))})),markDirty();let e=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{});for(let n of c)if(null==e[n]){let e=()=>{if(_[n]&&!_[n].pending&&_[n].length){_[n].pending=!0;let s=_[n].shift();/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(s)?installFromUrl(s,(e=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onInstall(e),_[n].pending=!1}),(t=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onFailure(t),_[n].pending=!1,e()})):installFromGID(GIDURL.fromString(s,t),(e=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onInstall(e),_[n].pending=!1}),(t=>{_manager__WEBPACK_IMPORTED_MODULE_2__.Z.onFailure(t),_[n].pending=!1,e()}))}};e()}return s}return"未知错误"}function parseMeta(e,t){let n=(e.match(/(?<=\/\*( )*MCBBS[ -]*Module)[\s\S]*?(?=\*\/)/)||[])[0]||"";n=n.replace(/\\\n/g,"");let s=n.split("\n"),a=/.+?\=.*/,o=/.+?(?=\=)/,r=/(?<=\=).*/;for(let e of s)if(a.test((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(e))){let n=((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(e).match(o)||[])[0]||"",s=((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(e).match(r)||[])[0]||"";t.set((0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(n),(0,_domutils__WEBPACK_IMPORTED_MODULE_5__.fy)(s))}}function regMeta(e,t){(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("meta-"+e,t);let n=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{});try{return(0,_native__WEBPACK_IMPORTED_MODULE_8__.Hn)(n,e,!0),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.all",n),!0}catch(e){return!1}}function mountCode(e,t){_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.load((()=>{(0,_domutils__WEBPACK_IMPORTED_MODULE_5__.Ys)("body").append(`<script id='code-${e}'>\n        (() => {\n          let MCBBS = Object.freeze(window.forkAPI_${(0,_encrypt__WEBPACK_IMPORTED_MODULE_1__.M)()}("${e}"));\n          ${t}\n        })();\n      <\/script>`)}))}function unmountCode(e){_domutils__WEBPACK_IMPORTED_MODULE_5__.lP.load((()=>{(0,_domutils__WEBPACK_IMPORTED_MODULE_5__.Ys)("#code-"+e).remove()}))}function deleteModule(e,t){(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.LB)("meta-"+e),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.LB)("code-"+e),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.LB)("depend-"+e);let n=(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.o9)("loader.all",{});(0,_native__WEBPACK_IMPORTED_MODULE_8__.Hn)(n,e,void 0),(0,_usfunc__WEBPACK_IMPORTED_MODULE_6__.s4)("loader.all",n),markDirty(),t()}function installFromGID(e,t,n){installFromUrl(e.getAsURL(),t,n,e)}function installFromUrl(e,t=(()=>{}),n=(()=>{}),s=GIDURL.NIL){(0,_crossorigin__WEBPACK_IMPORTED_MODULE_3__.e)(e,(()=>n("安装失败，网络请求失败")),(e=>{let a=addModule(e,s);"string"==typeof a?n(a):t(a),resortDependency()}))}function isDirty(){return dirty}function markDirty(){dirty=!0}function coreModEval(code){return new Promise(((resolve,reject)=>{try{eval(code),resolve(0)}catch(e){reject(e)}}))}},517:(e,t,n)=>{n.d(t,{Z:()=>_});var s=n(204),a=n(827),o=n(160),r=n(23),i=n(152);function l(){(0,r.Ys)("title").html("MCBBS Loader - 配置页面"),(0,r.Ys)("div[class='bm bw0']").html("<span style='font-size:1.5rem'>设置中心</span>&nbsp;&nbsp;<button id='saveconfig' type='button' class='pn pnc'><span>保存</span></button>&nbsp;<span style='color:#df307f'>您的设置应当会自动保存，如果没有，单击此按钮来保存。</span> <br/><div id='config_div'></div>"),(0,r.Ys)("#saveconfig").on("click",d),function(){if((0,r.Ys)(".a").removeClass("a"),(0,r.Ys)("#manage_config").parent().addClass("a"),!a.a.emitCancelable("ConfigPagePreRender")){for(let e of(0,s.vo)("CDT")){let t=`<label style='font-size:14px' for='confval-${e.id}-${e.stgid}'>\n        <span style='font-size:18px;color:#5d2391'>\n          <b>${e.name} </b>\n        </span>\n        (${e.id}:${e.stgid})\n        <br/>\n        <span style='color:#df307f'>${e.desc}</span>\n      </label>`;if("checkbox"==e.type?t=`<span style='font-size:14px'>\n          <span style='font-size:18px;color:#5d2391'>\n            <i id='confval-${e.id}-${e.stgid}' class='chkbox fa fa-check-square'></i>\n            &nbsp;\n            <b>${e.name}</b>\n          </span>\n          (${e.id}:${e.stgid})\n          <br/>\n          <span style='color:#df307f'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${e.desc}</span>\n          <div id='conferr-${e.id}-${e.stgid}'></div></span>\n          <br/>\n        </span>`:"textarea"==e.type?t+=`<br/>\n        <div id='conferr-${e.id}-${e.stgid}'></div>\n        <textarea id='confval-${e.id}-${e.stgid}' style="width: 99%;" class="loadertextconf"></textarea>\n        <br/>`:"button"==e.type?t+=`<br/>\n        <div id='conferr-${e.id}-${e.stgid}'></div>\n        <button style='float: right;' class='pn pnc' id='confval-${e.id}-${e.stgid}'>${e.value}</button>\n        <br/>`:t+=`<div style='height: 17px;'>\n          <input type='text' class='px loadertextconf' id='confval-${e.id}-${e.stgid}'/>\n          <div id='conferr-${e.id}-${e.stgid}'></div>\n          <br/>\n        </div>`,(0,r.Ys)("#config_div").append(t),"checkbox"==e.type){let t=c(e.id,e.stgid,!1)?"chkbox fa fa-check-square":"chkbox fa fa-square";document.getElementById(`confval-${e.id}-${e.stgid}`).className=t}else{let t=c(e.id,e.stgid,"");(0,r.Ys)(`[id='confval-${e.id}-${e.stgid}']`).val(t)}let n=document.getElementById(`confval-${e.id}-${e.stgid}`);"button"==e.type?n.onclick=e.check:(n.oninput=function(){let t=this;(0,r.Ys)(`#conferr-${e.id}-${e.stgid}`).html(e.check("checkbox"!=e.type?t.value:"chkbox fa fa-check-square"==t.className)||""),"textarea"==e.type&&(t.rows=t.value.split("\n").length)},n.oninput())}(0,r.Ys)(".chkbox").on("click",(e=>{var t;e.target.className="chkbox fa fa-"+((null===(t=e.target.className)||void 0===t?void 0:t.includes("check-square"))?"check-":"")+"square",e.target.oninput(),d()})),(0,r.Ys)(".loadertextconf").on("blur",d),a.a.emit("ConfigPagePostRender")}}()}function d(){for(let e of(0,s.vo)("CDT"))(0,s.s4)(`configstore-${e.id}-${e.stgid}`,"checkbox"===e.type?document.getElementById(`confval-${e.id}-${e.stgid}`).classList.contains("fa-check-square"):(0,r.Ys)(`[id='confval-${e.id}-${e.stgid}']`).val());(0,o.JV)("设置保存成功！")}function c(e,t,n){return(0,s.o9)(`configstore-${e}-${t}`,n)}const _={createMenu:function(){(0,s.oE)("getConfig",(function(e,t){return c(e,t,void 0)})),r.lP.load((()=>{(0,r.Ys)("div.appl > div.tbn > ul").prepend("<li><a id='manage_config' style='cursor:pointer;' href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=config'>模块选项中心</a></li>"),(0,r.Ys)("#manage_config").on("click",(e=>{(0,i.eT)()||(e.preventDefault(),l(),history.replaceState(null,null,"https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=config"))}))}))},dumpConfigPage:l,createConfigItem:function(e,t,n,a,o,r=(e=>{}),i){let l=(0,s.vo)("CDT"),d={id:e,type:a,stgid:t,name:n,desc:o,check:r,value:i};return l.push(d),(0,s.oE)("CDT",l),d},getConfigVal:c,setConfigVal:function(e,t,n){(0,s.o9)(`configstore-${e}-${t}`,n)}}},601:(e,t,n)=>{n.d(t,{e:()=>a});var s=n(204);function a(e,t=(()=>{}),n=(()=>{}),a="plain"){return(0,s.h0)({method:"GET",url:e,timeout:5e3,ontimeout:()=>t("网络错误：连接超时"),onerror:()=>t("网络错误：没有更多信息"),onload:e=>{if(200!=e.status)t(`错误：${e.status} ${e.statusText}`);else if("json"==a)try{n(JSON.parse(e.responseText))}catch(e){t("JSON解析错误")}else"plain"==a&&n(e.responseText)}})}},23:(e,t,n)=>{n.d(t,{lP:()=>a,Ys:()=>o,fy:()=>r});let s=[];window.addEventListener("load",(()=>{for(let e of s)e();s=null}));class a{constructor(e){this.elements=[];for(let t of e)this.elements.push(t)}static select(e){return new a("string"==typeof e?document.querySelectorAll(e):[e])}static ban(e){let t=document.createElement("span");t.innerHTML=e;let n=e=>{var s;if(["SCRIPT","APPLET","OBJECT","STYLE","LINK"].includes(e.tagName))return e.remove(),void(t.className="banned-by-bbs-loader");for(let n of e.getAttributeNames())n.startsWith("on")&&(e.removeAttribute(n),t.className="banned-by-bbs-loader");e instanceof HTMLLinkElement&&(null===(s=e.href)||void 0===s?void 0:s.startsWith("javascript"))&&(e.href="",t.className="banned-by-bbs-loader");for(let t of e.children)n(t)};return n(t),t.outerHTML}static load(e){return s?s.push(e):setTimeout(e,0),a}each(e){return this.elements.forEach(e),this}remove(){return this.each((e=>e.remove())),this}html(e){var t;return"string"==typeof e?this.each((t=>t.innerHTML=e)):null===(t=this.elements[0])||void 0===t?void 0:t.innerHTML}hasClass(e){var t;return null===(t=this.elements[0])||void 0===t?void 0:t.classList.contains(e)}removeClass(e){return this.each((t=>t.classList.remove(e)))}addClass(e){return this.each((t=>t.classList.add(e)))}css(e,t){var n;return"string"==typeof t?this.each((n=>n.style[e]=t)):null===(n=this.elements[0])||void 0===n?void 0:n.style[e]}val(e){var t;return"string"==typeof e?this.each((t=>t.value=e)):null===(t=this.elements[0])||void 0===t?void 0:t.value}on(e,t){return this.each((n=>n.addEventListener(e,t)))}append(e){return this.each((t=>{if("string"==typeof e){let n=document.createElement("span");for(n.innerHTML=e;n.childNodes[0];)t.append(n.childNodes[0])}else t.append(e)}))}prepend(e){return this.each((t=>{if("string"==typeof e){let n=document.createElement("span");for(n.innerHTML=e;n.childNodes[n.childNodes.length-1];)t.prepend(n.childNodes[n.childNodes.length-1])}else t.prepend(e)}))}after(e){return this.each((t=>{if("string"==typeof e){let n=document.createElement("span");for(n.innerHTML=e;n.childNodes[n.childNodes.length-1];)t.after(n.childNodes[n.childNodes.length-1])}else t.after(e)}))}parent(){let e=[];return this.each((t=>{t.parentElement&&e.push(t.parentElement)})),new a(e)}hide(){return this.css("display","none")}show(){return this.css("display","")}attr(e,t){var n;return"string"==typeof t?this.each((n=>n.setAttribute(e,t))):null===(n=this.elements[0])||void 0===n?void 0:n.getAttribute(e)}data(e,t){return this.attr("data-"+e,t)}foreach(e){for(let t in this.elements)e(t,this.elements[t]);return this}}function o(e){return a.select(e)}function r(e){return e?e.trim():""}},585:(e,t,n)=>{n.d(t,{M:()=>a});let s=Math.floor(1048576*Math.random()*1048576*1048576).toString(16);function a(){return s}},313:(e,t,n)=>{n.d(t,{Z:()=>h});var s=n(644),a=n(152),o=n(455),r=n(624),i=n(204),l=n(160),d=n(601),c=n(517),_=n(23);const p=new Map;function u(e,t,n){return`<li id='${e.id}'>\n    <div style='display:inline;'>\n      <img src='${e.icon||""}' width='50' height='50' style="vertical-align:middle;float:left;"/>\n      <div style="height: 8em">\n        &nbsp;&nbsp;\n        <span style='font-size:18px;color:${n}'>\n          <strong>${e.name||"Nameless"}</strong>\n        </span>\n        &nbsp;&nbsp;&nbsp;\n        <span id='vtag-${e.id}' style='font-size:12px;color:#150029;'>\n          ${e.id||"loader.nameless"}@${(e.version||"1.0.0")+(t?"&nbsp;<span style='color:#ff0000'><b>[COREMOD]</b></span>":"")}\n          <span style='color:#df307f;${(0,a.BR)().includes(e.id)?"":"display: none;"}'>\n            [依赖关系原因停用]\n          </span>\n        </span>\n        <br/>\n          &nbsp;&nbsp;\n        <span style='font-size:16px;color:#df307f;'>${e.author||"Someone"}</span>\n        <br/>\n        &nbsp;&nbsp;\n        <span style='font-size:12px'>${e.description}</span>\n        <div style="float: right;">\n          <button type='button' class='pn pnc remove' onclick='window.notifyUninstall("${e.id}")'>\n            <strong>删除模块</strong>\n          </button>\n          &nbsp;&nbsp;\n          <button type='button' class='pn pnc onoff' onclick='window.notifyOnOff("${e.id}")'>\n            <strong>${(0,i.o9)("loader.all",{})[e.id]?"禁用":"启用"}</strong>\n          </button>\n          <button type='button' class='pn pnc showsrc' data-mlsource='${e.id}'>\n            <strong>查看源代码</strong>\n          </button>\n        </div>\n      </div>\n    </div>\n  </li>`}function f(e){p.delete(e.get("id")),(0,a.t3)(),m(),(0,_.Ys)("#install_base64").val((0,i.o9)("code-"+e.get("id"),"")),(0,l.OL)({msg:`${_.lP.ban(e.get("name")||e.get("id"))}已成功安装在您的 MCBBS 上。\n      <br/>  \n      以下是有关本次安装的详情：\n      <br/>  \n      &nbsp;&nbsp;软件包类型：Mod\n      <br/>\n      &nbsp;&nbsp;软件包 ID：${_.lP.ban(e.get("id"))}\n      <br/>\n      &nbsp;作者：${_.lP.ban(e.get("author")||"未知")}\n      <br/>\n      &nbsp;&nbsp版本：${_.lP.ban(e.get("version")||"")}`,title:"安装简报",mode:"right"}),(0,l.JV)("成功安装了模块")}function b(e){(0,l.wp)(e,"安装失败",(()=>{}))}function m(){(0,_.Ys)("title").html("MCBBS Loader - 管理页面"),(0,_.Ys)(".a").removeClass("a"),setTimeout((()=>(0,_.Ys)("#loader_manager").parent().addClass("a")),50);let e=(0,a.ul)().replace(/\n/g,"<br>");_.lP.load((()=>{(0,_.Ys)("div[class='bm bw0']").css("user-select","none"),(0,_.Ys)("div[class='bm bw0']").html(`<span style='font-size:1.5rem'>模块管理&nbsp;&nbsp;&nbsp;版本&nbsp;${(0,s.Y)()}\n        <span style="font-size: 0.8em;color:red" >${(0,a.m4)()?"":"<br>依赖关系未解决"}</span>\n        <span style="font-size: 0.8em;color: brown" >${(0,a.eT)()?"<br>当前的设置需要刷新才能生效":""}</span>\n      </span>\n      <br/>\n      <hr/>\n      <span style='${(0,a.m4)()?"display:none;":""}font-size:1rem;'>错误</span>\n      <div id='deperr' style='overflow:auto;color:#ff0000;${(0,a.m4)()?"display:none;":""}'>\n        ${e}\n      </div>\n      <hr style='${(0,a.m4)()?"display:none;":""}'/>`+o.ZP),(0,_.Ys)("#use_mloader").on("click",(()=>(0,_.Ys)("#install_uno").val("MCBBS-Loader:仓库名:模块 ID:main"))),(0,_.Ys)("#use_cv").on("click",(()=>(0,_.Ys)("#install_uno").val("CaveNightingale:CaveNightingale-MCBBS-Modules:模块 ID:master"))),(0,_.Ys)("#use_mext").on("click",(()=>(0,_.Ys)("#install_uno").val("MCBBS-Loader:Integration-Motion:模块 ID:main"))),(0,_.Ys)("#debugmode").on("click",(()=>{"false"==(0,_.Ys)("#debugmode").attr("debug")?((0,_.Ys)("#debugmode").attr("debug","true"),(0,_.Ys)("#install_base64").show(),(0,_.Ys)("#install_uno").hide(),(0,_.Ys)(".srcc").hide()):((0,_.Ys)("#debugmode").attr("debug","false"),(0,_.Ys)("#install_base64").hide(),(0,_.Ys)("#install_uno").show(),(0,_.Ys)(".srcc").show())})),(0,i.oE)("notifyUninstall",(e=>{(0,a.wZ)(e,(()=>{(0,a.t3)(),m(),(0,l.JV)("成功移除了模块")}))})),(0,i.oE)("notifyOnOff",(e=>{let t=(0,i.o9)("loader.all",{});t[e]=!t[e],(0,i.s4)("loader.all",t),(0,a.no)(),(0,a.t3)(),m()})),(0,_.Ys)("#install").on("click",(()=>{var e;let t="true"==(0,_.Ys)("#debugmode").attr("debug")?"#install_base64":"#install_uno",n=(null===(e=(0,_.Ys)(t).val())||void 0===e?void 0:e.toString())||"";try{let e=(0,a.WM)(atob(n));if("string"!=typeof e)f(e);else if(/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(n)){(0,l.JV)("正在获取数据……");try{(0,d.e)(n,b,(e=>{let t=(0,a.WM)(e);"string"!=typeof t?f(t):b(t)}))}catch(e){let t=(0,a.WM)(n);"string"!=typeof t?f(t):(0,a.GK)(a.C5.fromString(n),f,b)}}else{let e=(0,a.WM)(n);"string"!=typeof e?f(e):(0,a.GK)(a.C5.fromString(n),f,b)}}catch(e){if(/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g.test(n)){(0,l.JV)("正在获取数据……");try{(0,d.e)(n,b,(e=>{let t=(0,a.WM)(e);"string"!=typeof t?f(t):b(t)}))}catch(e){let t=(0,a.WM)(n);"string"!=typeof t?f(t):(0,a.GK)(a.C5.fromString(n),f,b)}}else{let e=(0,a.WM)(n);"string"!=typeof e?f(e):(0,a.GK)(a.C5.fromString(n),f,(()=>b("无效 ID 或网络错误，所有安装途径均失败")))}}}));let t=(0,i.o9)("loader.all",{});for(let e of Object.entries(t)){let t=(0,i.o9)("meta-"+e[0],{id:"impossible"}),n=-1!=t.permissions.search("loader:core"),s=u(t,n,n?"#ff0000":"#5d2391");(0,_.Ys)("#all_modules").append(s)}(0,_.Ys)(".showsrc").on("click",(e=>{"false"==(0,_.Ys)("#debugmode").attr("debug")&&((0,_.Ys)("#debugmode").attr("debug","true"),(0,_.Ys)("#install_base64").show(),(0,_.Ys)("#install_uno").hide(),(0,_.Ys)(".srcc").hide());let t=(0,_.Ys)(e.target).data("mlsource")||(0,_.Ys)(e.target).parent().data("mlsource");t&&(0,_.Ys)("#install_base64").val((0,i.o9)("code-"+t,""))})),(0,_.Ys)("#all_modules > li").foreach(((e,t)=>{let n=(0,_.Ys)(t).attr("id")||"loader.impossible",s=(0,i.o9)("meta-"+n);p.get(n)!=s.version&&(p.set(n,s.version),(0,r.P)(s,((e,t,o)=>{if(p.get(n)!=s.version)return;let r;p.delete(n);let i=!1;switch(e){case"latest-api-too-early":r="<span style='color:#f16d2e'><b>[已过期]</b></span>";break;case"latest-no-update-url":case"latest-no-version":r="<span style='color:#636363'><b>[本地]</b></span>";break;case"latest-version-equal-or-earlier":r="<span style='color:#df307f'><b>[最新]</b></span>";break;default:e.startsWith("latest")||(r="<span style='color:#ffaec8'><b>[有可用更新]</b></span>",i=!0)}let d=(0,_.Ys)(`[id='vtag-${s.id}']`).html();d=`${d}${i?"&nbsp;->&nbsp;"+o:""}&nbsp;${r}`,(0,_.Ys)(`[id='vtag-${s.id}']`).html(d),i&&(0,_.Ys)(`[id='vtag-${s.id}']`).parent().append(`<button type='button' style='float:right' class='pn pnc update' data-mlurl='${e}'>\n                <strong>更新模块</strong>\n              </button>`),(0,_.Ys)(".update").on("click",(e=>{let t=(0,_.Ys)(e.target).data("mlurl")||(0,_.Ys)(e.target).parent().data("mlurl");t&&((0,_.Ys)(e.target).data("mlurl")?(0,_.Ys)(e.target).remove():(0,_.Ys)(e.target).parent().remove(),(0,a.no)(),(0,a.qA)(t,(()=>{m();let e=(0,_.Ys)(`[id='vtag-${s.id}']`).html();e=e.replace('<span style="color:#ffaec8"><b>[有可用更新]</b></span>',"<span style='color:#df307f'><b>[已更新]</b></span>"),(0,_.Ys)(`[id='vtag-${s.id}']`).html(e)}),(()=>{let e=(0,_.Ys)(`[id='vtag-${s.id}']`).html();e=e.replace('<span style="color:#ffaec8"><b>[有可用更新]</b></span>',"<span style='color:#ec1c24'><b>[更新失败]</b></span>"),(0,_.Ys)(`[id='vtag-${s.id}']`).html(e)}),a.C5.fromString(s.gid)),(0,l.JV)("已尝试更新，更新效果在更新完成后刷新页面才会显示。"))}))})))}))}))}const h={createBtn:function(){_.lP.load((()=>{(0,_.Ys)("ul.user_info_menu_btn").append("<li><a href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=manager'>MCBBS 模块管理</a></li>")}))},createMenu:function(){window.location.href.startsWith("https://www.mcbbs.net/home.php?mod=spacecp")&&(_.lP.load((()=>{(0,_.Ys)("div.appl > div.tbn > ul").prepend("<li><a id='loader_manager' href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=manager'style='cursor:pointer;'>模块管理</a></li>"),(0,_.Ys)("#loader_manager").on("click",(e=>{(0,a.eT)()||(e.preventDefault(),m(),history.replaceState(null,null,"https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=manager"))}))})),c.Z.createMenu())},dumpManager:m,onInstall:f,onFailure:b}},455:(e,t,n)=>{n.d(t,{QD:()=>s,ZP:()=>a,k7:()=>o,Uk:()=>r});const s="https://attachment.mcbbs.net/data/myattachment/forum/202104/30/181947s2ofgj3spsfj1pss.png",a="<span style='font-size:1rem'>已安装的模块</span>\n  <br/>\n  <div style='overflow:auto;'>\n    <ul id='all_modules'></ul>\n  </div>\n  <hr/>\n  <span style='font-size:1rem'>安装新模块</span>\n  <button debug='false' type='button' id='debugmode' class='pn pnc'>\n    <strong>调试模式</strong>\n  </button>\n  <br/>\n  <textarea style=\"display:none;font-family:'Fira Code','Courier New',monospace;background-color:#fbf2db;width:90%;height:150px;overflow:auto;word-break:break-all;resize:vertical;\" placeholder='BASE64 编码，URL 或 JavaScript 代码……' id='install_base64'></textarea>\n  <br/>\n  <input style='width:90%;font-family:\"Fira Code\",\"Courier New\",monospace;' type='text' class='px' id='install_uno' placeholder='使用 GID 安装……'/>\n  <br/>\n  <br/>\n  <button class='pn pnc' type='button' id='install'>\n    <strong>安装</strong>\n  </button>\n  <br/>\n  <br/>\n  <br/>\n  <button class='pn pnc srcc' type='button' id='use_cv'>\n    <strong>快速使用 洞穴夜莺 源（CaveNightingale）</strong>\n  </button>\n  <span class='srcc'>\n    洞穴夜莺的软件源中包含许多轻松使用模块，\n    <a id='preview_cv' style='color:#df307f'href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=repopreview#CaveNightingale%3ACaveNightingale-MCBBS-Modules%3Amanifest%3Amaster' target='_blank'>\n      预览该软件源\n    </a>\n    。\n  </span>\n  <br/>\n  <br/>\n  <button class='pn pnc srcc' type='button' id='use_mext'>\n    <strong>快速使用 MExt 整合运动 源（MExt-IM）</strong>\n  </button>\n  <span class='srcc'>\n    MExt 整合运动的软件源中包括了许多适合老用户的 MExt 模块，\n    <a id='preview_mext' style='color:#df307f' href='https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=repopreview#MCBBS-Loader%3AIntegration-Motion%3Amanifest%3Amain' target='_blank'>\n      预览该软件源\n    </a>。\n  </span>\n  <br/>\n</span>",o="&nbsp;&nbsp;\n  <input class=\"px\" id=\"viewsrc\" type=\"text\" style=\"width: 50%\" placeholder=\"输入新的软件源地址来加载预览\"/>\n  &nbsp;\n  <button type=\"button\" id=\"loadview\" class=\"pn pnc\">\n    <strong>加载预览</strong>\n  </button>\n  <br/>\n  <hr/>\n  <span style='font-size:1rem'>该软件源中的模块</span>\n  <span style='float: right;'>\n    <a href='javascript:;' style='color: #524229;' id='select-all-btn'>反选</a>\n    <a href='javascript:;' style='color: #524229;' id='apply-changes-btn'>应用</a>\n  </span>\n  <br/>\n  <div style='overflow:auto;'>\n    <ul id='all_modules'></ul>\n  </div>\n  <hr/>",r="#_popbg {\n  user-select: none;\n  cursor: default;\n  width: 100%;\n  height: 50px;\n  background-color: #02020275;\n  position: fixed;\n  bottom: -50px;\n  text-align: center;\n  color: #ffffff;\n}\n\ninput.loadertextconf {\n  background-color: white;\n  float: right;\n  width:50%;\n}"},624:(e,t,n)=>{n.d(t,{P:()=>r});var s=n(644),a=n(152),o=n(601);function r(e,t){let n=e.id||"loader.nameless",r=/^((file|https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/g;if(e.updateURL||e.gid){let i=e.updateURL?r.test(e.updateURL)?e.updateURL:a.C5.fromString(e.updateURL,a.C5.fromString(e.gid)).getAsURL():a.C5.fromString(e.gid).getAsURL();(0,o.e)(i,(()=>t("latest-network-err")),(o=>{let r=new Map;if((0,a.jw)(o,r),r.get("id")!=n)t("latest-diff-id");else if("string"==typeof r.get("version")){let n=r.get("version")||"1.0.0",a=e.version||"1.0.0";if(function(e,t){let n=e.split("."),s=t.split(".");if(1==n.length)return parseInt(n[0])>parseInt(s[0]||"0");for(let e=0;e<n.length;e++){if(parseInt(n[e])>parseInt(s[e]||"0"))return!0;if(parseInt(n[e])<parseInt(s[e]||"0"))return!1}return!1}(n,a)){let o=r.get("apiVersion");"string"==typeof o&&o!=String((0,s.Y)())?t("latest-api-too-early"):t(e.updateURL,a,n)}else t("latest-version-equal-or-earlier")}else t("latest-no-version")}))}else t("latest-no-update-url")}},827:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>loadEvents,a:()=>LoaderEvent});class LoaderEvent extends Event{constructor(e,t,n=!1){super(e,{bubbles:!0,cancelable:n}),this.name=e;for(let[e,n]of Object.entries(t))this[e]=n}static emit(e,t={}){document.dispatchEvent(new LoaderEvent(e,t))}static emitCancelable(e,t={}){let n=new LoaderEvent(e,t,!0);return document.dispatchEvent(n),n.defaultPrevented}}function loadEvents(){(async()=>{if(void 0!==unsafeWindow.ajaxpost){const __ajaxpost=unsafeWindow.ajaxpost;unsafeWindow.ajaxpost=(formid,showid,waitid,showidclass,submitbtn,recall)=>{LoaderEvent.emitCancelable("DiscuzAjaxPrePost",{formid,showid,waitid,showidclass,submitbtn,recall})||__ajaxpost(formid,showid,waitid,showidclass,submitbtn,(()=>{"function"==typeof recall?recall():eval(recall),LoaderEvent.emit("DiscuzAjaxPostPost",{formid,showid,waitid,showidclass,submitbtn,recall})}))}}if(void 0!==unsafeWindow.ajaxget){const __ajaxget=unsafeWindow.ajaxget;unsafeWindow.ajaxget=(url,showid,waitid,loading,display,recall)=>{LoaderEvent.emitCancelable("DiscuzAjaxPreGet",{url,showid,waitid,loading,display,recall})||__ajaxget(url,showid,waitid,loading,display,(()=>{"function"==typeof recall?recall():eval(recall),LoaderEvent.emit("DiscuzAjaxPostGet",{url,showid,waitid,loading,display,recall})}))}}if(void 0!==unsafeWindow.previewThread){let e=unsafeWindow.previewThread;unsafeWindow.previewThread=(t,n)=>{LoaderEvent.emitCancelable("ToggleThreadPreview",{tid:t,tbody:n})||e(t,n)}}if(void 0!==unsafeWindow.showWindow){let e=unsafeWindow.showWindow;unsafeWindow.showWindow=(t,n,s,a,o)=>{LoaderEvent.emitCancelable("WindowPreLoad",{win:t,url:n,method:s,cache:a,menuv:o})||e(t,n,s,a,o)}}if(void 0!==unsafeWindow.showMenu){let e=unsafeWindow.showMenu;unsafeWindow.showMenu=t=>{LoaderEvent.emitCancelable("MenuPreShow",{detail:t})||(e(t),LoaderEvent.emit("MenuPostShow",{detail:t}))}}if(void 0!==unsafeWindow.hideMenu){let e=unsafeWindow.hideMenu;unsafeWindow.hideMenu=(t,n)=>{LoaderEvent.emitCancelable("MenuPreHide",{attr:t,mtype:n})||(e(t,n),LoaderEvent.emit("MenuPostHide",{attr:t,mtype:n}))}}})()}},160:(e,t,n)=>{n.d(t,{wp:()=>o,JV:()=>i,s$:()=>a,OL:()=>r});var s=n(321);function a(e,t,n){(0,s.LP)().showDialog(e,"right",t,n)}function o(e,t,n){(0,s.LP)().showDialog(e,"alert",t,n)}function r(e){showDialog(e.msg,e.mode,e.title,e.onClick,e.cover,e.onCancel,e.confirmText,e.cancelText,e.closeTime,e.locationTime)}function i(e){(0,s.LP)().showError(e)}},321:(e,t,n)=>{function s(e,t,n){e[t]=n}function a(){return unsafeWindow||window}function o(){return{GM_addStyle,GM_deleteValue,GM_download,GM_getResourceText,GM_getResourceURL,GM_getValue,GM_listValues,GM_log,GM_notification,GM_setClipboard,GM_setValue}}n.d(t,{Hn:()=>s,LP:()=>a,rj:()=>o})},204:(e,t,n)=>{function s(e){GM_deleteValue(e)}function a(e,t){GM_setValue(e,t)}function o(e,t){return GM_getValue(e,t)}function r(e){GM_log(e)}function i(e,t){unsafeWindow[e]=t}function l(e){return unsafeWindow[e]}function d(e){return GM_xmlhttpRequest(e)}n.d(t,{LB:()=>s,s4:()=>a,o9:()=>o,n$:()=>r,h0:()=>d,oE:()=>i,vo:()=>l})}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=__webpack_require__(152),t=__webpack_require__(313),n=__webpack_require__(517),s=__webpack_require__(624),a=__webpack_require__(204),o=__webpack_require__(644);var r=__webpack_require__(160),i=__webpack_require__(455),l=__webpack_require__(601),d=__webpack_require__(23);const c=function n(s){(0,d.Ys)("title").html("MCBBS Loader - 软件源");let o=e.C5.fromString(s);(0,d.Ys)(".a").removeClass("a");let c=new Set;(0,d.Ys)("div[class='bm bw0']").css("user-select","none").html(`<span style='font-size:1.0rem'>正在预览软件源 ${s}</span>`+i.k7),(0,d.Ys)("#viewsrc").val(s),(0,d.Ys)("#loadview").on("click",(()=>{open("https://www.mcbbs.net/home.php?mod=spacecp&bbsmod=repopreview#"+encodeURIComponent(e.C5.fromString((0,d.Ys)("#viewsrc").val(),o).asString()),"_self"),n(e.C5.fromString((0,d.Ys)("#viewsrc").val(),o).asString())})),function(n,s){(0,l.e)(n.getAsURL(".json"),(e=>(0,d.Ys)("#all_modules").html("无法显示该软件源的预览。<br/>"+e)),(n=>{if("object"!=typeof n)(0,d.Ys)("#all_modules").html("无法显示该软件源的预览。<br/>无效的JSON");else{for(let[e,t]of Object.entries(n)){let t=n[e];t.id=t.id||"impossible",t.name=t.name||"Nameless",t.author=t.author||"Someone",t.description=t.description||"No description provided.",t.permissions=t.permissions||"";let s=t.permissions.includes("loader:core"),o=t.permissions.includes("loader:earlyload"),r=null!=(0,a.o9)("meta-"+t.id),l=r?"#575757":"#5d2391",c=r?"&nbsp;<span style='color:#575757'><b>[已安装]</b></span>":"",_=`<li id='${t.id}'>\n          <div style='display:inline;'>\n            <img src='${t.icon||i.QD}' width='50' height='50' style="vertical-align:middle;float:left;"/>\n            <div style="height: 8em">\n              &nbsp;&nbsp;\n              <span style='font-size:18px;color:${l}'>\n                <strong>${t.name||"Nameless"}</strong>\n              </span>\n              &nbsp;&nbsp;&nbsp;\n              <span id='vtag-${t.id}' style='font-size:12px;color:#150029;'>\n                ${t.id}@${(t.version||"1.0.0")+(s?"&nbsp;<span style='color:#ff0000'><b>[核心模块]</b></span>":"")+(o?"&nbsp;<span style='color:#0000ff'><b>[早期加载]</b></span>":"")+c}\n              </span>\n              <br/>\n              &nbsp;&nbsp;\n              <span style='font-size:16px;color:#df307f;'>\n                ${t.author||"Someone"}\n              </span>\n              <br/>\n              &nbsp;&nbsp;\n              <span style='font-size:12px'>\n                ${t.description}\n              </span>\n              <input type='checkbox' class='fast-install-chk' style='float: right;' gtar='${t.gid}'/>\n              <button class='pn pnc insremote' style='float:right;' data-gtar='${t.gid}'>\n                <strong>安装/更新</strong>\n              </button>\n            </div>\n          </div>\n        </li>`;(0,d.Ys)("#all_modules").append(_)}(0,d.Ys)(".insremote").on("click",(n=>{let s=null!=n.target.getAttribute("data-gtar")?n.target:n.target.parentElement;(0,e.GK)(e.C5.fromString(s.getAttribute("data-gtar"),o),(e=>t.Z.onInstall(e)),(e=>t.Z.onFailure(e)))}));let s=!1;(0,d.Ys)(".fast-install-chk").on("click",(e=>{s?e.preventDefault():e.target.checked?c.add(e.target.getAttribute("data-gtar")):c.delete(e.target.getAttribute("data-gtar"))})),(0,d.Ys)("#apply-changes-btn").on("click",(()=>{if(!c.size)return;if(s)return;s=!0;let n=[],a=[],i=()=>{if((0,e.t3)(),n.length+a.length==c.size){let e=`成功安装了 ${n.length} 个模块:`;for(let t of n)e+="<br>&nbsp;&nbsp;&nbsp;&nbsp;"+t.get("name");if(a.length){e+=`<br>未能安装 ${a.length} 个模块:`;for(let[t,n]of a)e+=`<br>&nbsp;&nbsp;&nbsp;&nbsp;${t}&nbsp;&nbsp;&nbsp;&nbsp${n}`;(0,r.wp)(e,"安装失败",(()=>t.Z.dumpManager()))}(0,r.s$)(e,"安装成功",(()=>t.Z.dumpManager())),s=!1}};c.forEach((t=>{(0,e.GK)(e.C5.fromString(t,o),(e=>{n.push(e),i()}),(e=>{a.push([t,e]),i()}))})),(0,r.JV)("安装中，请稍后")})),(0,d.Ys)("#select-all-btn").on("click",(e=>{s||(0,d.Ys)(".fast-install-chk").each((e=>e.click()))}))}}),"json")}(o)};var _=__webpack_require__(827);function p(){(0,d.Ys)("#ct").hasClass("wp cl w")&&((0,d.Ys)("#ct").remove(),(0,d.Ys)("#wp").html('<div id="pt" class="bm cl">\n    <div class="z">\n    <a href="./" class="nvhm" title="首页">Minecraft(我的世界)中文论坛</a> <em>›</em>\n    <a href="home.php?mod=spacecp">设置</a> <em>›</em>个人资料\n    </div>\n    </div><div id="ct" class="ct2_a wp cl">\n    <div class="mn">\n    <div class="bm bw0" style="user-select: none;"></div>\n    </div>\n    <div class="appl"><div class="tbn">\n    <h2 class="mt bbda">设置</h2>\n    <ul>'))}(0,a.oE)("__onExtraScriptLoaded",(e=>e())),d.lP.load((function(){(async()=>{let e=new MutationObserver((e=>{for(let n of e)"childList"==(t=n).type&&(t.addedNodes.length>0&&(e=>{switch(e.target.nodeName){case"DIV":void 0!==e.target.id&&(e.target.id.lastIndexOf("threadPreview_")>=0?"SPAN"==e.addedNodes[0].nodeName&&" 请稍候..."==e.addedNodes[0].innerText&&e.target.dispatchEvent(new CustomEvent("ThreadPreviewPreOpen",{bubbles:!0})):e.addedNodes.length>=3&&e.target.id.lastIndexOf("post_")>=0?"A"==e.addedNodes[0].nodeName&&"newpost"==e.addedNodes[0].name&&null!=e.addedNodes[0].parentNode&&e.target.dispatchEvent(new CustomEvent("ThreadFlushFinished",{bubbles:!0})):"append_parent"==e.target.id?"DIV"==e.addedNodes[0].nodeName&&("fwin_rate"==e.addedNodes[0].id?e.addedNodes[0].dispatchEvent(new CustomEvent("RateWindowPreOpen",{bubbles:!0})):"fwin_reply"==e.addedNodes[0].id?e.addedNodes[0].dispatchEvent(new CustomEvent("ReplyWindowPreOpen",{bubbles:!0})):void 0!==e.addedNodes[0].id&&e.addedNodes[0].id.lastIndexOf("fwin_miscreport")>=0&&e.addedNodes[0].dispatchEvent(new CustomEvent("ReportWindowPreOpen",{bubbles:!0}))):""===e.target.id&&null!=e.target.parentElement&&"postlistreply"==e.target.parentElement&&e.target.dispatchEvent(new CustomEvent("NewReplyAppended",{bubbles:!0})));break;case"A":"#text"==e.addedNodes[0].nodeName&&"undefined"==typeof tid&&("正在加载, 请稍后..."==e.addedNodes[0].nodeValue?e.target.dispatchEvent(new CustomEvent("ThreadsListLoadStart",{bubbles:!0})):"下一页 »"==e.addedNodes[0].nodeValue&&e.target.dispatchEvent(new CustomEvent("ThreadsListLoadFinished",{bubbles:!0})));break;case"TD":"fwin_content_rate"==e.target.id&&"DIV"==e.addedNodes[0].nodeName&&"floatlayout_topicadmin"==e.addedNodes[0].id&&e.target.dispatchEvent(new CustomEvent("RateWindowOpened",{bubbles:!0})),"fwin_content_reply"==e.target.id&&"H3"==e.addedNodes[0].nodeName&&"fctrl_reply"==e.addedNodes[0].id&&e.target.dispatchEvent(new CustomEvent("ReplyWindowOpened",{bubbles:!0})),void 0!==e.target.id&&e.target.id.lastIndexOf("fwin_content_miscreport")>=0&&"H3"==e.addedNodes[0].nodeName&&e.addedNodes[0].id.lastIndexOf("fctrl_miscreport")>=0&&e.target.dispatchEvent(new CustomEvent("ReportWindowOpened",{bubbles:!0}))}})(t),t.removedNodes.length>0&&(e=>{switch(e.target.nodeName){case"TBODY":void 0!==e.target.id&&e.target.id.lastIndexOf("normalthread_")>=0&&e.target.dispatchEvent(new CustomEvent("ThreadPreviewClosed",{bubbles:!0}));break;case"DIV":void 0!==e.target.id&&e.target.id.lastIndexOf("threadPreview_")>=0?"SPAN"==e.removedNodes[0].nodeName&&" 请稍候..."==e.removedNodes[0].innerText&&e.target.dispatchEvent(new CustomEvent("ThreadPreviewOpened",{bubbles:!0})):e.removedNodes.length>=3&&e.target.id.lastIndexOf("post_")>=0?"A"==e.removedNodes[0].nodeName&&"newpost"==e.removedNodes[0].name&&null!=e.removedNodes[0].parentNode&&e.target.dispatchEvent(new CustomEvent("ThreadFlushStarted",{bubbles:!0})):"append_parent"==e.target.id&&"DIV"==e.removedNodes[0].nodeName&&("fwin_rate"==e.removedNodes[0].id?e.target.dispatchEvent(new CustomEvent("RateWindowClosed",{bubbles:!0})):"fwin_reply"==e.removedNodes[0].id?e.target.dispatchEvent(new CustomEvent("ReplyWindowClosed",{bubbles:!0})):void 0!==e.removedNodes[0].id&&e.removedNodes[0].id.lastIndexOf("fwin_miscreport")>=0&&e.target.dispatchEvent(new CustomEvent("ReportWindowClosed",{bubbles:!0})))}})(t));var t}));document.addEventListener("DOMContentLoaded",(()=>{unsafeWindow.MExt||e.observe(document.body,{childList:!0,subtree:!0})})),addEventListener("DiscuzAjaxPostPost",(()=>document.dispatchEvent(new CustomEvent("DiscuzAjaxPostFinished",{bubbles:!0})))),addEventListener("DiscuzAjaxPostGet",(()=>document.dispatchEvent(new CustomEvent("DiscuzAjaxGetFinished",{bubbles:!0}))))})()})).load(_.w).load((()=>{(0,d.Ys)("head").append("<link type='text/css' rel='stylesheet'\n          href='https://cdn.staticfile.org/font-awesome/5.15.1/css/all.min.css'/>").append("<link type='text/css' rel='stylesheet'\n          href='https://cdn.staticfile.org/font-awesome/5.15.1/css/v4-shims.min.css'/>").append(`<style id="mcbbs-loader-common-css">${i.Uk}</style>`)})),(0,a.n$)("[LoaderMin] 加载器和 API 版本："+(0,o.Y)()),d.lP.load((()=>{let o=(0,a.o9)("loader.sortedModuleList")||(0,e.t3)();for(let t of o)(0,e.uk)(t,(0,a.o9)("code-"+t)),(e=>{(0,s.P)((0,a.o9)("meta-"+e,""),((t,n,s)=>{t.startsWith("latest")||console.log(`[MCBBS Loader] 有更新可用，模块 ${e} 具有新版本 ${s}，当前安装的版本为 ${n}。`)}))})(t);(0,e.ul)().length&&console.log("[MCBBS Loader] 部分模块未加载，请到管理页面修复依赖关系错误"),t.Z.createBtn(),t.Z.createMenu();let r=String(window.location.search);if(/bbsmod=repopreview/i.test(r)){p();let e=window.location.hash.indexOf("#");c(-1!=e?decodeURIComponent(window.location.hash.substring(1)):"MCBBS-Loader/examplemod@main")}else/bbsmod=manager/i.test(r)?(p(),t.Z.dumpManager()):/bbsmod=config/i.test(r)&&(p(),setTimeout((()=>n.Z.dumpConfigPage()),0))}))})()})();